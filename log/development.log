  [1m[35m (1.2ms)[0m  [1m[35mCREATE DATABASE `acm_sys_development` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE `acm_sys_test` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (2.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `messages_count` int, `number` int, `app_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_chats_on_app_id` (`app_id`), CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
Started GET "/app/show/" for 127.0.0.1 at 2022-11-19 15:49:55 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mCACHE ActiveRecord::SchemaMigration Pluck (0.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  
ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

        bin/rails db:migrate RAILS_ENV=development

You have 2 pending migrations:

20221119133802_create_chats.rb
20221119133856_create_apps.rb


):
  
activerecord (7.0.4) lib/active_record/migration.rb:627:in `check_pending!'
activerecord (7.0.4) lib/active_record/migration.rb:592:in `block (2 levels) in call'
activesupport (7.0.4) lib/active_support/file_update_checker.rb:83:in `execute'
activerecord (7.0.4) lib/active_record/migration.rb:597:in `block in call'
activerecord (7.0.4) lib/active_record/migration.rb:589:in `synchronize'
activerecord (7.0.4) lib/active_record/migration.rb:589:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.4) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.4) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
web-console (4.2.0) lib/web_console/middleware.rb:132:in `call_app'
web-console (4.2.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (4.2.0) lib/web_console/middleware.rb:17:in `catch'
web-console (4.2.0) lib/web_console/middleware.rb:17:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/show_exceptions.rb:26:in `call'
railties (7.0.4) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.4) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.4) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.4) lib/rack/method_override.rb:24:in `call'
rack (2.2.4) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.4) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.4) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
railties (7.0.4) lib/rails/engine.rb:530:in `call'
puma (5.6.5) lib/puma/configuration.rb:252:in `call'
puma (5.6.5) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.5) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.5) lib/puma/request.rb:76:in `handle_request'
puma (5.6.5) lib/puma/server.rb:443:in `process_client'
puma (5.6.5) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (4.0ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `messages_count` int, `number` int, `app_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_chats_on_app_id` (`app_id`), CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (3.3ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `messages_count` int, `number` int, `app_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_chats_on_app_id` (`app_id`), CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `messages_count` int, `number` int, `apps_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_chats_on_apps_id` (`apps_id`), CONSTRAINT `fk_rails_ef134b80c9`
FOREIGN KEY (`apps_id`)
  REFERENCES `apps` (`id`)
)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `messages_count` int, `number` int, `app_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_chats_on_app_id` (`app_id`), CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `messages_count` int, `number` int, `app_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_chats_on_app_id` (`app_id`), CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `messages_count` int, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `chats_count` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'development', '2022-11-19 13:53:07.429280', '2022-11-19 13:53:07.429280')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Started GET "/app/show/" for 127.0.0.1 at 2022-11-19 16:10:57 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:6:in `index'
Completed 200 OK in 8ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 4244)


Started GET "/app/search/?name=first%20application" for 127.0.0.1 at 2022-11-19 16:11:04 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"first application"}
  [1m[36mApp Load (1.2ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'first application' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:14:in `get'
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 1.2ms | Allocations: 2416)


Started GET "/app/search/?name=first%20application" for 127.0.0.1 at 2022-11-19 16:12:22 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"first application"}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'first application' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:14:in `get'
Completed 200 OK in 5ms (Views: 0.2ms | ActiveRecord: 1.3ms | Allocations: 2419)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-19 16:12:24 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:5:in `index'
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 0.9ms | Allocations: 804)


Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-19 16:13:25 +0200
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
Can't verify CSRF token authenticity.
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:25:in `post'
  [1m[36mApp Create (0.3ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `chats_count`, `created_at`, `updated_at`) VALUES ('jGRcsx2vpZhXVzK6byRSHXWM', 'application 1', NULL, '2022-11-19 14:13:25.191390', '2022-11-19 14:13:25.191390')[0m
  â†³ app/controllers/app_controller.rb:25:in `post'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:25:in `post'
Completed 201 Created in 10ms (Views: 0.1ms | ActiveRecord: 2.8ms | Allocations: 8004)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-19 16:13:29 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:5:in `index'
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:6:in `index'
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 1371)


Started GET "/app/search/?name=first%20application" for 127.0.0.1 at 2022-11-19 16:13:39 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"first application"}
  [1m[36mApp Load (1.6ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'first application' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:14:in `get'
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.6ms | Allocations: 804)


Started GET "/app/search/?name=first%20application" for 127.0.0.1 at 2022-11-19 16:14:01 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"first application"}
  [1m[36mApp Load (0.1ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'first application' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:14:in `get'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.2ms | Allocations: 2408)


  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT `ar_internal_metadata`.`value` FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT `ar_internal_metadata`.`value` FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT `ar_internal_metadata`.`value` FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (8.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS `acm_sys_development`[0m
  [1m[35m (0.7ms)[0m  [1m[35mDROP DATABASE IF EXISTS `acm_sys_test`[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE `acm_sys_development` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE `acm_sys_test` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[35m (7.3ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `messages_count` int, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `chats_count` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddChatFkColToApp (20221119141908)
  [1m[35m (5.3ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (4.9ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (8.5ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119141908')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'development', '2022-11-19 14:21:01.529044', '2022-11-19 14:21:01.529044')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddChatFkColToApp (20221119141908)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddChatFkColToApp (20221119141908)
  [1m[35m (4.0ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (6.2ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119141908'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddChatFkColToApp (20221119141908)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddChatFkColToApp (20221119141908)
  [1m[35m (3.6ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (8.7ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (3.1ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (7.8ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119141908')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddChatFkColToApp (20221119141908)
  [1m[35m (5.6ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (5.5ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (4.4ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (7.2ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119141908'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (3.6ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (9.9ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (3.2ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (9.0ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (5.7ms)[0m  [1m[35mCREATE DATABASE `acm_sys_development` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE DATABASE `acm_sys_test` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (11.1ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[35m (6.4ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (8.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (8.7ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (9.4ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `messages_count` int DEFAULT 0, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (13.7ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `chats_count` int DEFAULT 0, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (18.2ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (9.5ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (14.7ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (3.5ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.6ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (10.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (5.5ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.3ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'development', '2022-11-21 07:49:04.291986', '2022-11-21 07:49:04.291986')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (21.9ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (28.2ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (4.6ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (8.7ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (5.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (20.4ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (2.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (10.4ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (3.9ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (7.6ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (10.9ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (11.9ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `messages_count` int DEFAULT 0, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (13.3ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `chats_count` int DEFAULT 0, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (16.2ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (9.2ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (12.8ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (5.1ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (15.3ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (19.8ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (18.8ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (17.8ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (7.8ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (7.4ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (5.4ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (29.2ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (4.9ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.6ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (9.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-21 13:02:19 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  
SyntaxError (/Users/marwahany/study/acm_sys/app/controllers/app_controller.rb:25: syntax error, unexpected '|', expecting ')'
...Chat.select(:number).find_all(|obj| obj.app_id == app.id)
...                              ^
/Users/marwahany/study/acm_sys/app/controllers/app_controller.rb:25: syntax error, unexpected ')', expecting `end'
...all(|obj| obj.app_id == app.id)
...                              ^
):
  
app/controllers/app_controller.rb:25: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:25: syntax error, unexpected ')', expecting `end'
app/controllers/app_controller.rb:25: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:25: syntax error, unexpected ')', expecting `end'
app/controllers/app_controller.rb:25: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:25: syntax error, unexpected ')', expecting `end'
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-21 13:08:30 +0200
  
SyntaxError (/Users/marwahany/study/acm_sys/app/controllers/app_controller.rb:25: syntax error, unexpected '|', expecting ')'
...Chat.select(:number).find_all(|obj| obj.app_id == app[:id])
...                              ^
/Users/marwahany/study/acm_sys/app/controllers/app_controller.rb:25: syntax error, unexpected ')', expecting `end'
...l(|obj| obj.app_id == app[:id])
...                              ^
):
  
app/controllers/app_controller.rb:25: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:25: syntax error, unexpected ')', expecting `end'
app/controllers/app_controller.rb:25: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:25: syntax error, unexpected ')', expecting `end'
app/controllers/app_controller.rb:25: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:25: syntax error, unexpected ')', expecting `end'
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (39.6ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (13.5ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (7.2ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (9.7ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (5.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (6.0ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.4ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (3.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (4.6ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (8.1ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (15.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (11.8ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_token` ON `chats` (`token`)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (7.0ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (12.0ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (14.8ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (24.8ms)[0m  [1m[35mDROP DATABASE IF EXISTS `acm_sys_development`[0m
  [1m[35m (1.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS `acm_sys_test`[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE DATABASE `acm_sys_development` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE DATABASE `acm_sys_test` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (1.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `chats` CASCADE[0m
  [1m[35m (9.9ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (21.3ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (0)[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'development', '2022-11-21 11:32:27.398695', '2022-11-21 11:32:27.398695')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.1ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '1a4da1fcb6f09026ec9228ff6a1df365312369a3', '2022-11-21 11:32:27.404090', '2022-11-21 11:32:27.404090')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `chats` CASCADE[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (0)[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'development', '2022-11-21 11:32:27.422340', '2022-11-21 11:32:27.422340')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Update (0.5ms)[0m  [1m[33mUPDATE `ar_internal_metadata` SET `ar_internal_metadata`.`value` = 'test', `ar_internal_metadata`.`updated_at` = '2022-11-21 11:32:27.425934' WHERE `ar_internal_metadata`.`key` = 'environment'[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.1ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '1a4da1fcb6f09026ec9228ff6a1df365312369a3', '2022-11-21 11:32:27.429165', '2022-11-21 11:32:27.429165')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (11.0ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.`value` FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT `ar_internal_metadata`.`value` FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT `ar_internal_metadata`.`value` FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (17.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS `acm_sys_development`[0m
  [1m[35m (11.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS `acm_sys_test`[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE DATABASE `acm_sys_development` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE DATABASE `acm_sys_test` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (7.8ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (9.5ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (19.4ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (6.3ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (4.9ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (12.3ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (6.1ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.9ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (10.9ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.4ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'development', '2022-11-21 11:32:54.102024', '2022-11-21 11:32:54.102024')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-21 13:33:50 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  
SyntaxError (/Users/marwahany/study/acm_sys/app/controllers/app_controller.rb:24: syntax error, unexpected '|', expecting ')'
...Chat.select(:number).find_all(|obj| obj.app_id == app.id)
...                              ^
/Users/marwahany/study/acm_sys/app/controllers/app_controller.rb:24: syntax error, unexpected ')', expecting `end'
...all(|obj| obj.app_id == app.id)
...                              ^
):
  
app/controllers/app_controller.rb:24: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:24: syntax error, unexpected ')', expecting `end'
app/controllers/app_controller.rb:24: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:24: syntax error, unexpected ')', expecting `end'
app/controllers/app_controller.rb:24: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:24: syntax error, unexpected ')', expecting `end'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 13:34:04 +0200
  
SyntaxError (/Users/marwahany/study/acm_sys/app/controllers/app_controller.rb:24: syntax error, unexpected '|', expecting ')'
...Chat.select(:number).find_all(|obj| obj.app_id == app.id)
...                              ^
/Users/marwahany/study/acm_sys/app/controllers/app_controller.rb:24: syntax error, unexpected ')', expecting `end'
...all(|obj| obj.app_id == app.id)
...                              ^
):
  
app/controllers/app_controller.rb:24: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:24: syntax error, unexpected ')', expecting `end'
app/controllers/app_controller.rb:24: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:24: syntax error, unexpected ')', expecting `end'
app/controllers/app_controller.rb:24: syntax error, unexpected '|', expecting ')'
app/controllers/app_controller.rb:24: syntax error, unexpected ')', expecting `end'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 13:35:09 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 15ms (Views: 0.2ms | ActiveRecord: 4.1ms | Allocations: 5512)


Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-21 13:35:35 +0200
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
Can't verify CSRF token authenticity.
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
  [1m[36mApp Create (0.5ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('FNzKpd24BdFCchRkEowrsRMt', 'application 1', '2022-11-21 11:35:35.629641', '2022-11-21 11:35:35.629641')[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
Completed 201 Created in 23ms (Views: 0.1ms | ActiveRecord: 5.9ms | Allocations: 6806)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 13:35:38 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
  [1m[36mApp Load (1.7ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:8:in `index'
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 2.3ms | Allocations: 1409)


Started GET "/app/search/?name=first%20application%201" for 127.0.0.1 at 2022-11-21 13:38:52 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"first application 1"}
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` IS NULL LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 15ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 5951)


Started GET "/app/search/?name=application%201" for 127.0.0.1 at 2022-11-21 13:39:06 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` IS NULL LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 784)


Started GET "/app/search/?name=FNzKpd24BdFCchRkEowrsRMt" for 127.0.0.1 at 2022-11-21 13:39:17 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"FNzKpd24BdFCchRkEowrsRMt"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` IS NULL LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 762)


Started GET "/app/search/?name=FNzKpd24BdFCchRkEowrsRMt" for 127.0.0.1 at 2022-11-21 13:39:54 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"FNzKpd24BdFCchRkEowrsRMt"}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` IS NULL LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 2.4ms | Allocations: 2634)


Started GET "/app/search/?name=application%201" for 127.0.0.1 at 2022-11-21 13:40:02 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` IS NULL LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 766)


Started GET "/app/search/?name=application%201" for 127.0.0.1 at 2022-11-21 13:40:32 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`name` = 'application 1' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 14ms (Views: 0.3ms | ActiveRecord: 7.8ms | Allocations: 4418)


Started GET "/app/search/?name=application%201" for 127.0.0.1 at 2022-11-21 13:40:52 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'application 1' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 7.3ms | Allocations: 4034)


Started POST "/create/app?name=application%202" for 127.0.0.1 at 2022-11-21 13:42:07 +0200
Processing by AppController#post as */*
  Parameters: {"name"=>"application 2"}
Can't verify CSRF token authenticity.
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
  [1m[36mApp Create (0.6ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('dCZi3HBh6EhAbCL4RpjrvswW', 'application 2', '2022-11-21 11:42:07.457997', '2022-11-21 11:42:07.457997')[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
Completed 201 Created in 16ms (Views: 0.1ms | ActiveRecord: 9.9ms | Allocations: 5160)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 13:42:10 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:8:in `index'
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 1.7ms | Allocations: 1579)


Started GET "/app/search/?name=application%202" for 127.0.0.1 at 2022-11-21 13:42:15 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 2"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'application 2' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 8ms (Views: 1.6ms | ActiveRecord: 0.6ms | Allocations: 995)


Started GET "/app/search/?name=application%202" for 127.0.0.1 at 2022-11-21 13:43:40 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 2"}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'application 2' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:43:in `set_app'
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 6.3ms | Allocations: 4001)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 13:43:48 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
  [1m[36mApp Count (3.2ms)[0m  [1m[34mSELECT COUNT(*) FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:9:in `index'
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 3.8ms | Allocations: 1372)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 13:44:10 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 500 Internal Server Error in 16ms (ActiveRecord: 3.9ms | Allocations: 6462)


  
NoMethodError (undefined method `chats' for App:Class):
  
app/controllers/app_controller.rb:9:in `index'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 13:44:57 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:8:in `index'
Completed 200 OK in 11ms (Views: 0.1ms | ActiveRecord: 6.1ms | Allocations: 4460)


Started GET "/app/search/?name=application%202" for 127.0.0.1 at 2022-11-21 13:45:02 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 2"}
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'application 2' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
  [1m[36mChat Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM `chats` WHERE `chats`.`app_id` IS NULL[0m
  â†³ app/controllers/app_controller.rb:16:in `get'
Completed 200 OK in 33ms (Views: 0.1ms | ActiveRecord: 5.1ms | Allocations: 8014)


Started GET "/app/search/?name=application%202" for 127.0.0.1 at 2022-11-21 13:45:28 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 2"}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'application 2' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 5.9ms | Allocations: 4002)


Started GET "/app/search/?name=application%203" for 127.0.0.1 at 2022-11-21 13:47:21 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 3"}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'application 3' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 500 Internal Server Error in 13ms (ActiveRecord: 3.5ms | Allocations: 6081)


  
NameError (undefined local variable or method `not_found' for #<AppController:0x00000000032910>

            render json: {"message": " app does not exist."}.to_json, status: not_found
                                                                              ^^^^^^^^^):
  
app/controllers/app_controller.rb:18:in `get'
Started GET "/app/search/?name=application%203" for 127.0.0.1 at 2022-11-21 13:47:38 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 3"}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'application 3' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 404 Not Found in 7ms (Views: 0.1ms | ActiveRecord: 3.5ms | Allocations: 2799)


  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (34.1ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (7.6ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (2.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (24.5ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (8.3ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (18.3ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (13.8ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (4.3ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (20.5ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (3.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (7.0ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (2.9ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (6.7ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (9.8ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (8.0ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (7.4ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (9.8ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (12.3ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (8.1ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (15.0ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (4.2ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (11.3ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (8.8ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 20:36:54 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 20ms (Views: 0.2ms | ActiveRecord: 2.3ms | Allocations: 5310)


Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-21 20:37:01 +0200
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
Can't verify CSRF token authenticity.
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
  [1m[36mApp Create (0.9ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('Jp7Gf98hcPLhTXWY4E8erQRh', 'application 1', '2022-11-21 18:37:01.619515', '2022-11-21 18:37:01.619515')[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
Completed 201 Created in 19ms (Views: 0.1ms | ActiveRecord: 5.3ms | Allocations: 6870)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 20:37:05 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:8:in `index'
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 1410)


Started GET "/app/search/?name=application%201" for 127.0.0.1 at 2022-11-21 20:37:19 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 1"}
Completed 404 Not Found in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 130)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 20:37:39 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
  [1m[36mApp Load (1.1ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:8:in `index'
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 1.6ms | Allocations: 1244)


Started GET "/app/search/?name=application%201" for 127.0.0.1 at 2022-11-21 20:42:21 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 1"}
Completed 404 Not Found in 2ms (Views: 0.4ms | ActiveRecord: 0.0ms | Allocations: 128)


Started GET "/app/search/?name=application%201" for 127.0.0.1 at 2022-11-21 20:42:43 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 1"}
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 310)


Started GET "/app/search/?name=application%201" for 127.0.0.1 at 2022-11-21 20:43:14 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 1"}
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 325)


Started GET "/app/search/?name=application%201" for 127.0.0.1 at 2022-11-21 20:43:38 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'application 1' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 14ms (Views: 0.2ms | ActiveRecord: 6.5ms | Allocations: 4972)


Started GET "/app/search/?name=application%201" for 127.0.0.1 at 2022-11-21 20:44:32 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'application 1' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 6.0ms | Allocations: 4002)


Started GET "/app/search/?name=application%201" for 127.0.0.1 at 2022-11-21 20:44:35 +0200
Processing by AppController#get as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'application 1' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 5ms (Views: 0.3ms | ActiveRecord: 0.6ms | Allocations: 824)


Started GET "/app/chats?name=application%201" for 127.0.0.1 at 2022-11-21 20:45:30 +0200
Processing by AppController#get_chats as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'application 1' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 500 Internal Server Error in 19ms (ActiveRecord: 7.5ms | Allocations: 8999)


  
NameError (undefined local variable or method `app' for #<AppController:0x0000000001e938>

            chats = Chat.select(:number).find_by(app.id)
                                                 ^^^
Did you mean?  @app):
  
app/controllers/app_controller.rb:24:in `get_chats'
Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:45:50 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (1.2ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` IS NULL LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 1.2ms | Allocations: 960)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:46:24 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` IS NULL LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 10ms (Views: 0.1ms | ActiveRecord: 2.7ms | Allocations: 2793)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:47:51 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 2.3ms | Allocations: 2793)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 20:49:28 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:8:in `index'
Completed 200 OK in 15ms (Views: 0.2ms | ActiveRecord: 8.9ms | Allocations: 4402)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:49:42 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.`id`, `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`name` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 972)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:50:05 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.`id`, `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.`number` FROM `chats` WHERE `chats`.`app_id` = 1 LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:24:in `get_chats'
Completed 200 OK in 21ms (Views: 0.1ms | ActiveRecord: 11.7ms | Allocations: 6542)


Started GET "/app/search/?token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:50:46 +0200
Processing by AppController#get as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.`id`, `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 13ms (Views: 0.3ms | ActiveRecord: 6.7ms | Allocations: 4034)


Started GET "/app/search/?token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:52:12 +0200
Processing by AppController#get as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.`id`, `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 11ms (Views: 0.1ms | ActiveRecord: 6.5ms | Allocations: 3981)


Started GET "/app/search/?token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:52:42 +0200
Processing by AppController#get as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.`id`, `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
Completed 200 OK in 13ms (Views: 0.1ms | ActiveRecord: 7.6ms | Allocations: 3979)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 20:53:17 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:8:in `index'
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 1369)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-21 20:53:27 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
  [1m[36mApp Load (3.0ms)[0m  [1m[34mSELECT `apps`.`name`, `apps`.`token` FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:8:in `index'
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 3.5ms | Allocations: 1241)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:54:14 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.`id`, `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:42:in `set_app'
  [1m[36mChat Load (0.3ms)[0m  [1m[34mSELECT `chats`.`number` FROM `chats` WHERE `chats`.`app_id` = 1 LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:24:in `get_chats'
Completed 200 OK in 25ms (Views: 0.2ms | ActiveRecord: 3.1ms | Allocations: 7790)


Started GET "/create/app?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:56:38 +0200
  
ActionController::RoutingError (No route matches [GET] "/create/app"):
  
Started GET "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:57:11 +0200
  
ActionController::RoutingError (No route matches [GET] "/create/chat"):
  
Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:57:27 +0200
  
SyntaxError (/Users/marwahany/study/acm_sys/app/controllers/chat_controller.rb:19: unknown type of %string
...n app %s " %chat_obj.number %params[:app_token]}.to_json, st...
...                            ^~~
/Users/marwahany/study/acm_sys/app/controllers/chat_controller.rb:19: syntax error, unexpected end-of-input, expecting '}'
...n app %s " %chat_obj.number %params[:app_token]}.to_json, st...
...                            ^~~
):
  
app/controllers/chat_controller.rb:19: unknown type of %string
app/controllers/chat_controller.rb:19: syntax error, unexpected end-of-input, expecting '}'
app/controllers/chat_controller.rb:19: unknown type of %string
app/controllers/chat_controller.rb:19: syntax error, unexpected end-of-input, expecting '}'
app/controllers/chat_controller.rb:19: unknown type of %string
app/controllers/chat_controller.rb:19: syntax error, unexpected end-of-input, expecting '}'
Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:58:15 +0200
  
SyntaxError (/Users/marwahany/study/acm_sys/app/controllers/chat_controller.rb:19: unknown type of %string
... app %s " %chat_obj.number, %params[:app_token]}.to_json, st...
...                            ^~~
/Users/marwahany/study/acm_sys/app/controllers/chat_controller.rb:19: syntax error, unexpected end-of-input, expecting '}'
... app %s " %chat_obj.number, %params[:app_token]}.to_json, st...
...                            ^~~
):
  
app/controllers/chat_controller.rb:19: unknown type of %string
app/controllers/chat_controller.rb:19: syntax error, unexpected end-of-input, expecting '}'
app/controllers/chat_controller.rb:19: unknown type of %string
app/controllers/chat_controller.rb:19: syntax error, unexpected end-of-input, expecting '}'
app/controllers/chat_controller.rb:19: unknown type of %string
app/controllers/chat_controller.rb:19: syntax error, unexpected end-of-input, expecting '}'
Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 20:59:04 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
Can't verify CSRF token authenticity.
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:14:in `post'
Completed 400 Bad Request in 24ms (Views: 0.1ms | ActiveRecord: 13.1ms | Allocations: 8074)


Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 21:00:54 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
Can't verify CSRF token authenticity.
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:14:in `post'
Completed 400 Bad Request in 22ms (Views: 0.1ms | ActiveRecord: 12.8ms | Allocations: 6776)


Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 21:00:55 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
Can't verify CSRF token authenticity.
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:14:in `post'
Completed 400 Bad Request in 24ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1040)


Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 21:02:11 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:15:in `post'
Completed 400 Bad Request in 20ms (Views: 0.1ms | ActiveRecord: 11.9ms | Allocations: 6747)


Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 21:02:19 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:15:in `post'
Completed 400 Bad Request in 29ms (Views: 0.2ms | ActiveRecord: 10.4ms | Allocations: 14008)


Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 21:02:38 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:15:in `post'
Completed 400 Bad Request in 21ms (Views: 0.1ms | ActiveRecord: 12.4ms | Allocations: 6781)


Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 21:03:56 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:15:in `post'
Completed 400 Bad Request in 27ms (Views: 0.1ms | ActiveRecord: 18.7ms | Allocations: 6735)


Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 21:04:04 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:15:in `post'
Completed 400 Bad Request in 20ms (Views: 0.2ms | ActiveRecord: 11.4ms | Allocations: 6782)


Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 21:08:18 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:15:in `post'
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1 /* loading for inspect */ LIMIT 11[0m
Completed 500 Internal Server Error in 31ms (ActiveRecord: 6.8ms | Allocations: 11309)


  [1m[36mCACHE Chat Load (0.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1 /* loading for inspect */ LIMIT 11[0m
  
NoMethodError (undefined method `creat' for #<ActiveRecord::Associations::CollectionProxy []>
Did you mean?  create
               create!):
  
app/controllers/chat_controller.rb:18:in `post'
Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-21 21:08:29 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:15:in `post'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:18:in `post'
  [1m[36mChat Create (0.7ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`) VALUES (NULL, '2022-11-21 19:08:29.356928', '2022-11-21 19:08:29.356928', 1)[0m
  â†³ app/controllers/chat_controller.rb:18:in `post'
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/controllers/chat_controller.rb:18:in `post'
Completed 500 Internal Server Error in 32ms (ActiveRecord: 15.3ms | Allocations: 14118)


  
ActiveModel::MissingAttributeError (can't write unknown attribute `chats_count`

          raise ActiveModel::MissingAttributeError, "can't write unknown attribute `#{name}`"
          ^^^^^):
  
app/controllers/chat_controller.rb:18:in `post'
  [1m[36mActiveRecord::SchemaMigration Pluck (12.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (20.6ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (7.4ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (6.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (15.7ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (16.8ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (10.6ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (14.7ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (7.6ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.0ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (6.7ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (2.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (6.3ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (10.7ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (9.2ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (9.0ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (11.2ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (10.7ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (24.6ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (5.8ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (10.6ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (7.2ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE `applications` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (17.1ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (9.5ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.9ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (4.9ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (6.6ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (9.9ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (8.9ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 10:55:21 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
Completed 500 Internal Server Error in 10ms (ActiveRecord: 0.0ms | Allocations: 6737)


  
NameError (undefined local variable or method `apps' for #<AppController:0x0000000000b838>

        if apps.any?
           ^^^^
Did you mean?  @apps):
  
app/controllers/app_controller.rb:7:in `index'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 10:55:35 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 7ms (Views: 0.4ms | ActiveRecord: 2.8ms | Allocations: 3367)


Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-22 10:55:40 +0200
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
Can't verify CSRF token authenticity.
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
  [1m[36mApp Create (0.4ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`, `chats_count`) VALUES ('zbaeucnv22rFisffccTLWqjd', 'application 1', '2022-11-22 08:55:40.829122', '2022-11-22 08:55:40.829122', 0)[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:34:in `post'
Completed 201 Created in 21ms (Views: 0.1ms | ActiveRecord: 7.0ms | Allocations: 7735)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 10:55:43 +0200
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 500 Internal Server Error in 17ms (ActiveRecord: 0.5ms | Allocations: 2951)


  
NameError (uninitialized constant Blueprinter

class AppBlueprint < Blueprinter::Base
                     ^^^^^^^^^^^):
  
app/blueprints/app_blueprint.rb:1:in `<main>'
app/controllers/app_controller.rb:8:in `index'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 10:56:40 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
  [1m[36mApp Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `apps` LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 500 Internal Server Error in 11ms (ActiveRecord: 2.5ms | Allocations: 6472)


  
NoMethodError (undefined method `token' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:8:in `index'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 10:58:28 +0200
Processing by AppController#index as */*
Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.0ms | Allocations: 2572)


  
NoMethodError (undefined method `token' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:7:in `index'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:00:29 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mCACHE ActiveRecord::SchemaMigration Pluck (0.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  
ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

        bin/rails db:migrate RAILS_ENV=development

You have 1 pending migration:

20221122090014_add_index_to_app_table.rb


):
  
activerecord (7.0.4) lib/active_record/migration.rb:627:in `check_pending!'
activerecord (7.0.4) lib/active_record/migration.rb:592:in `block (2 levels) in call'
activesupport (7.0.4) lib/active_support/file_update_checker.rb:83:in `execute'
activerecord (7.0.4) lib/active_record/migration.rb:597:in `block in call'
activerecord (7.0.4) lib/active_record/migration.rb:589:in `synchronize'
activerecord (7.0.4) lib/active_record/migration.rb:589:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.4) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.4) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
web-console (4.2.0) lib/web_console/middleware.rb:132:in `call_app'
web-console (4.2.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (4.2.0) lib/web_console/middleware.rb:17:in `catch'
web-console (4.2.0) lib/web_console/middleware.rb:17:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/show_exceptions.rb:26:in `call'
railties (7.0.4) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.4) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.4) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.4) lib/rack/method_override.rb:24:in `call'
rack (2.2.4) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.4) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.4) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
railties (7.0.4) lib/rails/engine.rb:530:in `call'
puma (5.6.5) lib/puma/configuration.rb:252:in `call'
puma (5.6.5) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.5) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.5) lib/puma/request.rb:76:in `handle_request'
puma (5.6.5) lib/puma/server.rb:443:in `process_client'
puma (5.6.5) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (23.9ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (14.3ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (5.9ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (27.5ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX `index_applications_on_token` ON `applications` (`token`)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (26.0ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (15.6ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (7.3ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (20.9ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (12.6ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (16.1ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (7.9ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (8.2ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (6.9ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (4.5ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.4ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (7.0ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (7.2ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (9.0ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (9.1ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (10.3ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (9.7ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (10.8ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (3.6ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (6.2ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (11.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (9.1ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (5.5ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (6.8ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (7.3ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX `index_applications_on_token` ON `applications` (`token`)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (27.7ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:01:55 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
Completed 500 Internal Server Error in 9ms (ActiveRecord: 0.0ms | Allocations: 4780)


  
NoMethodError (undefined method `token' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:7:in `index'
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-22 11:02:56 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
Can't verify CSRF token authenticity.
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (0.8ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`, `chats_count`) VALUES ('EHmJBfWNXWRa6GNZJt4zv1Sw', 'application 1', '2022-11-22 09:02:56.507351', '2022-11-22 09:02:56.507351', 0)[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 20ms (Views: 0.2ms | ActiveRecord: 8.3ms | Allocations: 11649)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:03:00 +0200
Processing by AppController#index as */*
Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.0ms | Allocations: 1621)


  
NoMethodError (undefined method `token' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:7:in `index'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:03:58 +0200
Processing by AppController#index as */*
Completed 500 Internal Server Error in 5ms (ActiveRecord: 0.0ms | Allocations: 2587)


  
NoMethodError (undefined method `chats_count' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:7:in `index'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:04:32 +0200
Processing by AppController#index as */*
Completed 500 Internal Server Error in 3ms (ActiveRecord: 0.0ms | Allocations: 2606)


  
NoMethodError (undefined method `token' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:6:in `index'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:19:02 +0200
Processing by AppController#index as */*
Completed 500 Internal Server Error in 1ms (Allocations: 1182)


  
NoMethodError (undefined method `token' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:6:in `index'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:22:24 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
Completed 500 Internal Server Error in 7ms (ActiveRecord: 0.0ms | Allocations: 4786)


  
NoMethodError (undefined method `token' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:6:in `index'
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:23:31 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
Completed 500 Internal Server Error in 7ms (ActiveRecord: 0.0ms | Allocations: 4849)


  
NoMethodError (undefined method `id' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:6:in `index'
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` ORDER BY `apps`.`id` ASC LIMIT 1[0m
  [1m[36mApp Load (1.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` ORDER BY `apps`.`id` ASC LIMIT 1[0m
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` ORDER BY `apps`.`id` ASC LIMIT 1[0m
  [1m[36mApp Load (1.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:28:03 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
Completed 500 Internal Server Error in 6ms (ActiveRecord: 0.0ms | Allocations: 4786)


  
NoMethodError (undefined method `token' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:6:in `index'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:28:37 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:6:in `index'
Completed 200 OK in 98ms (Views: 0.2ms | ActiveRecord: 9.6ms | Allocations: 10929)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:28:53 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:6:in `index'
Completed 200 OK in 14ms (Views: 0.2ms | ActiveRecord: 9.1ms | Allocations: 4123)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 11:28:54 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (1.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:6:in `index'
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 1.6ms | Allocations: 748)


Started GET "/app/search/?token=[FILTERED]" for 127.0.0.1 at 2022-11-22 11:29:17 +0200
Processing by AppController#get as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (6.3ms)[0m  [1m[34mSELECT `apps`.`id`, `apps`.`name`, `apps`.`token` FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
Completed 500 Internal Server Error in 23ms (ActiveRecord: 6.3ms | Allocations: 9755)


  
ActiveModel::MissingAttributeError (missing attribute: chats_count):
  
app/controllers/app_controller.rb:11:in `get'
Started GET "/app/search/?token=[FILTERED]" for 127.0.0.1 at 2022-11-22 11:29:46 +0200
Processing by AppController#get as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 6.8ms | Allocations: 4377)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-22 11:30:31 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.`number` FROM `chats` WHERE `chats`.`app_id` = 1 LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:19:in `get_chats'
Completed 500 Internal Server Error in 19ms (ActiveRecord: 8.0ms | Allocations: 7659)


  
Zeitwerk::NameError (expected file /Users/marwahany/study/acm_sys/app/blueprints/chat_blueprint.rb to define constant ChatBlueprint, but didn't

      raise Zeitwerk::NameError.new("expected file #{file} to define constant #{cpath}, but didn't", cref.last)
      ^^^^^):
  
app/controllers/app_controller.rb:20:in `get_chats'
Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-22 11:31:27 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
  [1m[36mChat Load (0.3ms)[0m  [1m[34mSELECT `chats`.`number` FROM `chats` WHERE `chats`.`app_id` = 1 LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:19:in `get_chats'
Completed 500 Internal Server Error in 19ms (ActiveRecord: 9.2ms | Allocations: 7815)


  
NoMethodError (undefined method `number' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:20:in `get_chats'
Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-22 11:32:25 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
  [1m[36mChat Load (2.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1 LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:19:in `get_chats'
Completed 500 Internal Server Error in 22ms (ActiveRecord: 12.1ms | Allocations: 8066)


  
NoMethodError (undefined method `number' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:20:in `get_chats'
Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-22 11:34:03 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (1.1ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
  [1m[36mChat Load (1.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1 LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:19:in `get_chats'
Completed 500 Internal Server Error in 13ms (ActiveRecord: 2.1ms | Allocations: 2214)


  
NoMethodError (undefined method `number' for nil:NilClass

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/app_controller.rb:20:in `get_chats'
Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-22 11:35:51 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
Completed 500 Internal Server Error in 20ms (ActiveRecord: 4.6ms | Allocations: 5182)


  
NoMethodError (undefined method `chats' for nil:NilClass

            chats = @application.chats
                                ^^^^^^):
  
app/controllers/app_controller.rb:19:in `get_chats'
Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-22 11:36:07 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:20:in `get_chats'
Completed 200 OK in 22ms (Views: 0.1ms | ActiveRecord: 9.1ms | Allocations: 8978)


  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (26.7ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (10.2ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (8.8ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 16:49:13 +0200
  
ActiveRecord::DatabaseConnectionError (There is an issue connecting to your database with your username/password, username: root.

Please check your database configuration to ensure the username/password are valid.
):
  
activerecord (7.0.4) lib/active_record/connection_adapters/mysql2_adapter.rb:49:in `rescue in new_client'
activerecord (7.0.4) lib/active_record/connection_adapters/mysql2_adapter.rb:43:in `new_client'
activerecord (7.0.4) lib/active_record/connection_adapters/mysql2_adapter.rb:23:in `mysql2_connection'
activerecord (7.0.4) lib/active_record/connection_adapters/abstract/connection_pool.rb:656:in `public_send'
activerecord (7.0.4) lib/active_record/connection_adapters/abstract/connection_pool.rb:656:in `new_connection'
activerecord (7.0.4) lib/active_record/connection_adapters/abstract/connection_pool.rb:700:in `checkout_new_connection'
activerecord (7.0.4) lib/active_record/connection_adapters/abstract/connection_pool.rb:679:in `try_to_checkout_new_connection'
activerecord (7.0.4) lib/active_record/connection_adapters/abstract/connection_pool.rb:640:in `acquire_connection'
activerecord (7.0.4) lib/active_record/connection_adapters/abstract/connection_pool.rb:341:in `checkout'
activerecord (7.0.4) lib/active_record/connection_adapters/abstract/connection_pool.rb:181:in `connection'
activerecord (7.0.4) lib/active_record/connection_adapters/abstract/connection_handler.rb:211:in `retrieve_connection'
activerecord (7.0.4) lib/active_record/connection_handling.rb:313:in `retrieve_connection'
activerecord (7.0.4) lib/active_record/connection_handling.rb:280:in `connection'
activerecord (7.0.4) lib/active_record/migration.rb:613:in `connection'
activerecord (7.0.4) lib/active_record/migration.rb:608:in `build_watcher'
activerecord (7.0.4) lib/active_record/migration.rb:590:in `block in call'
activerecord (7.0.4) lib/active_record/migration.rb:589:in `synchronize'
activerecord (7.0.4) lib/active_record/migration.rb:589:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.4) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.4) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
web-console (4.2.0) lib/web_console/middleware.rb:132:in `call_app'
web-console (4.2.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (4.2.0) lib/web_console/middleware.rb:17:in `catch'
web-console (4.2.0) lib/web_console/middleware.rb:17:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/show_exceptions.rb:26:in `call'
railties (7.0.4) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.4) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.4) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.4) lib/rack/method_override.rb:24:in `call'
rack (2.2.4) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.4) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.4) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
railties (7.0.4) lib/rails/engine.rb:530:in `call'
puma (5.6.5) lib/puma/configuration.rb:252:in `call'
puma (5.6.5) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.5) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.5) lib/puma/request.rb:76:in `handle_request'
puma (5.6.5) lib/puma/server.rb:443:in `process_client'
puma (5.6.5) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (1.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (2.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (5.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (43.1ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (7.1ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (7.8ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (5.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (17.6ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (15.6ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (10.1ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 16:50:44 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
  [1m[36mApp Load (1.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:6:in `index'
Completed 200 OK in 20ms (Views: 0.2ms | ActiveRecord: 9.1ms | Allocations: 9033)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (50.9ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (5.7ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (13.5ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (7.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (37.2ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (19.5ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (12.2ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mApp Load (30.1ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  [1m[36mApp Load (3.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` ORDER BY `apps`.`id` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mChat Create (26.3ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 20:37:59.143748', '2022-11-22 20:37:59.143748', 1)[0m
  [1m[36mApp Update All (12.0ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  [1m[36mTRANSACTION (4.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mChat Load (4.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (2.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (19.9ms)[0m  [1m[35mALTER TABLE `message` ADD `chat_number` int[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (65.3ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (34.4ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number_and_chat_number` ON `messages` (`number`, `chat_number`)[0m
  [1m[35m (17.1ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_number` ON `messages` (`chat_number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:23:22 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.0ms | Allocations: 2550)


  
NoMethodError (undefined method `chats' for nil:NilClass

        @chat = @app.chats.create!
                    ^^^^^^):
  
app/controllers/chat_controller.rb:12:in `post'
Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:23:57 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` IS NULL AND `chats`.`application_token` IS NULL LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:37:in `set_chat'
Completed 500 Internal Server Error in 26ms (ActiveRecord: 11.7ms | Allocations: 11229)


  
NoMethodError (undefined method `chats' for nil:NilClass

        @chat = @app.chats.create!
                    ^^^^^^):
  
app/controllers/chat_controller.rb:12:in `post'
Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:24:23 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` IS NULL AND `chats`.`application_token` IS NULL LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
Completed 500 Internal Server Error in 18ms (ActiveRecord: 10.5ms | Allocations: 6454)


  
NoMethodError (undefined method `id' for nil:NilClass

      puts @app.id
               ^^^):
  
app/controllers/chat_controller.rb:12:in `post'
Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:24:35 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` IS NULL AND `chats`.`application_token` IS NULL LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
Completed 500 Internal Server Error in 13ms (ActiveRecord: 6.7ms | Allocations: 6365)


  
NoMethodError (undefined method `chats' for nil:NilClass

      @chat = @app.chats.create!
                  ^^^^^^):
  
app/controllers/chat_controller.rb:13:in `post'
Started POST "/create/chat?app_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:25:39 +0200
Processing by ChatController#post as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` IS NULL AND `chats`.`application_token` IS NULL LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:37:in `set_chat'
Completed 500 Internal Server Error in 14ms (ActiveRecord: 6.3ms | Allocations: 6350)


  
NoMethodError (undefined method `chats' for nil:NilClass

      @chat = @app.chats.create!
                  ^^^^^^):
  
app/controllers/chat_controller.rb:12:in `post'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:25:58 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` IS NULL AND `chats`.`application_token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:37:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 33ms (Views: 0.3ms | ActiveRecord: 26.6ms | Allocations: 4436)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:26:38 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` IS NULL AND `chats`.`application_token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:37:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 12ms (Views: 0.1ms | ActiveRecord: 6.3ms | Allocations: 3773)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:28:23 +0200
  
NameError (undefined local variable or method `post' for ChatController:Class

    before_action :set_app, only: [post]
                                   ^^^^):
  
app/controllers/chat_controller.rb:2:in `<class:ChatController>'
app/controllers/chat_controller.rb:1:in `<main>'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:28:31 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (4.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
Completed 500 Internal Server Error in 14ms (ActiveRecord: 7.2ms | Allocations: 3729)


  
NoMethodError (undefined method `chats' for nil:NilClass

      @chat = @app.chats.create
                  ^^^^^^):
  
app/controllers/chat_controller.rb:12:in `post'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:29:50 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:45:in `set_app'
Completed 500 Internal Server Error in 14ms (Views: 0.2ms | ActiveRecord: 4.9ms | Allocations: 5349)


  
NameError (uninitialized constant ChatController::RedisService

        redis = RedisService.new
                ^^^^^^^^^^^^):
  
app/controllers/chat_controller.rb:37:in `new_chat_number'
app/controllers/chat_controller.rb:17:in `post'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:30:24 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (2.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
Completed 500 Internal Server Error in 10ms (ActiveRecord: 5.8ms | Allocations: 3610)


  
NoMethodError (undefined method `chats' for nil:NilClass

      @chat = @app.chats.create
                  ^^^^^^):
  
app/controllers/chat_controller.rb:12:in `post'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:34:52 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Jp7Gf98hcPLhTXWY4E8erQRh' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
Completed 500 Internal Server Error in 17ms (ActiveRecord: 5.8ms | Allocations: 7066)


  
NoMethodError (undefined method `chats' for nil:NilClass

      @chat = @app.chats.create
                  ^^^^^^):
  
app/controllers/chat_controller.rb:12:in `post'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-22 23:36:22 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (17.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:6:in `index'
Completed 200 OK in 69ms (Views: 3.6ms | ActiveRecord: 23.5ms | Allocations: 5310)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:36:29 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (2.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (1.7ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 21:36:29.623409', '2022-11-22 21:36:29.623409', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (6.7ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (9.5ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 500 Internal Server Error in 82ms (ActiveRecord: 43.4ms | Allocations: 16037)


  
NameError (uninitialized constant ChatController::RedisService

        redis = RedisService.new
                ^^^^^^^^^^^^):
  
app/controllers/chat_controller.rb:33:in `new_chat_number'
app/controllers/chat_controller.rb:13:in `post'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:39:28 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (2.1ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (1.4ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 21:39:28.891587', '2022-11-22 21:39:28.891587', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (1.3ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 500 Internal Server Error in 26ms (ActiveRecord: 8.2ms | Allocations: 6315)


  
NameError (uninitialized constant ChatController::RedisService

        redis = RedisService.new
                ^^^^^^^^^^^^):
  
app/controllers/chat_controller.rb:33:in `new_chat_number'
app/controllers/chat_controller.rb:13:in `post'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:41:13 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (2.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (2.8ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 21:41:13.761146', '2022-11-22 21:41:13.761146', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (1.0ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 500 Internal Server Error in 25ms (ActiveRecord: 7.3ms | Allocations: 6255)


  
NameError (uninitialized constant ChatController::RedisService

        redis = RedisService.new
                ^^^^^^^^^^^^):
  
app/controllers/chat_controller.rb:33:in `new_chat_number'
app/controllers/chat_controller.rb:13:in `post'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:43:53 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (3.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (1.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (5.5ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 21:43:53.393823', '2022-11-22 21:43:53.393823', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.8ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (7.2ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 500 Internal Server Error in 104ms (ActiveRecord: 34.1ms | Allocations: 25115)


  
NameError (uninitialized constant ChatController::RedisService

        redis = RedisService.new
                ^^^^^^^^^^^^):
  
app/controllers/chat_controller.rb:33:in `new_chat_number'
app/controllers/chat_controller.rb:13:in `post'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:50:46 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (1.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (21.5ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (6.1ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 21:50:46.821580', '2022-11-22 21:50:46.821580', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.9ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 500 Internal Server Error in 63ms (ActiveRecord: 32.9ms | Allocations: 6670)


  
NameError (uninitialized constant ChatController::RedisService

        redis = RedisService.new
                ^^^^^^^^^^^^):
  
app/controllers/chat_controller.rb:33:in `new_chat_number'
app/controllers/chat_controller.rb:13:in `post'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:53:31 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (1.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (2.0ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (5.6ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 21:53:31.527707', '2022-11-22 21:53:31.527707', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.8ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 500 Internal Server Error in 97ms (ActiveRecord: 32.9ms | Allocations: 25121)


  
NameError (uninitialized constant ChatController::RedisService

        redis = RedisService.new
                ^^^^^^^^^^^^):
  
app/controllers/chat_controller.rb:33:in `new_chat_number'
app/controllers/chat_controller.rb:13:in `post'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:54:41 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (1.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (1.9ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 21:54:41.500405', '2022-11-22 21:54:41.500405', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.9ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 500 Internal Server Error in 38ms (ActiveRecord: 6.8ms | Allocations: 6524)


  
NameError (uninitialized constant ChatController::RedisService

        redis = RedisService.new
                ^^^^^^^^^^^^):
  
app/controllers/chat_controller.rb:33:in `new_chat_number'
app/controllers/chat_controller.rb:13:in `post'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-22 23:57:16 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Entity in 1ms (ActiveRecord: 0.0ms | Allocations: 580)


  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (7.0.4) lib/action_controller/metal/request_forgery_protection.rb:251:in `handle_unverified_request'
actionpack (7.0.4) lib/action_controller/metal/request_forgery_protection.rb:284:in `handle_unverified_request'
actionpack (7.0.4) lib/action_controller/metal/request_forgery_protection.rb:273:in `verify_authenticity_token'
activesupport (7.0.4) lib/active_support/callbacks.rb:400:in `block in make_lambda'
activesupport (7.0.4) lib/active_support/callbacks.rb:199:in `block (2 levels) in halting'
actionpack (7.0.4) lib/abstract_controller/callbacks.rb:34:in `block (2 levels) in <module:Callbacks>'
activesupport (7.0.4) lib/active_support/callbacks.rb:200:in `block in halting'
activesupport (7.0.4) lib/active_support/callbacks.rb:595:in `block in invoke_before'
activesupport (7.0.4) lib/active_support/callbacks.rb:595:in `each'
activesupport (7.0.4) lib/active_support/callbacks.rb:595:in `invoke_before'
activesupport (7.0.4) lib/active_support/callbacks.rb:116:in `block in run_callbacks'
activesupport (7.0.4) lib/active_support/callbacks.rb:138:in `run_callbacks'
actionpack (7.0.4) lib/abstract_controller/callbacks.rb:233:in `process_action'
actionpack (7.0.4) lib/action_controller/metal/rescue.rb:22:in `process_action'
actionpack (7.0.4) lib/action_controller/metal/instrumentation.rb:67:in `block in process_action'
activesupport (7.0.4) lib/active_support/notifications.rb:206:in `block in instrument'
activesupport (7.0.4) lib/active_support/notifications/instrumenter.rb:24:in `instrument'
activesupport (7.0.4) lib/active_support/notifications.rb:206:in `instrument'
actionpack (7.0.4) lib/action_controller/metal/instrumentation.rb:66:in `process_action'
actionpack (7.0.4) lib/action_controller/metal/params_wrapper.rb:259:in `process_action'
activerecord (7.0.4) lib/active_record/railties/controller_runtime.rb:27:in `process_action'
actionpack (7.0.4) lib/abstract_controller/base.rb:151:in `process'
actionview (7.0.4) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.4) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.4) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.4) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.4) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.4) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.4) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.4) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.4) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.4) lib/rack/tempfile_reaper.rb:15:in `call'
rack (2.2.4) lib/rack/etag.rb:27:in `call'
rack (2.2.4) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.4) lib/rack/head.rb:12:in `call'
actionpack (7.0.4) lib/action_dispatch/http/permissions_policy.rb:38:in `call'
actionpack (7.0.4) lib/action_dispatch/http/content_security_policy.rb:36:in `call'
rack (2.2.4) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.4) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/cookies.rb:696:in `call'
activerecord (7.0.4) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.4) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.4) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
web-console (4.2.0) lib/web_console/middleware.rb:132:in `call_app'
web-console (4.2.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (4.2.0) lib/web_console/middleware.rb:17:in `catch'
web-console (4.2.0) lib/web_console/middleware.rb:17:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/show_exceptions.rb:26:in `call'
railties (7.0.4) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.4) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.4) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.4) lib/rack/method_override.rb:24:in `call'
rack (2.2.4) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.4) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.4) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
railties (7.0.4) lib/rails/engine.rb:530:in `call'
puma (5.6.5) lib/puma/configuration.rb:252:in `call'
puma (5.6.5) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.5) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.5) lib/puma/request.rb:76:in `handle_request'
puma (5.6.5) lib/puma/server.rb:443:in `process_client'
puma (5.6.5) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 00:00:18 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (1.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (2.1ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 22:00:18.810306', '2022-11-22 22:00:18.810306', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.7ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 500 Internal Server Error in 59ms (ActiveRecord: 36.2ms | Allocations: 14042)


  
NameError (uninitialized constant ChatController::RedisService

        redis = RedisService.new
                ^^^^^^^^^^^^):
  
app/controllers/chat_controller.rb:33:in `new_chat_number'
app/controllers/chat_controller.rb:13:in `post'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 00:01:45 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (1.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (1.0ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 22:01:45.250280', '2022-11-22 22:01:45.250280', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.6ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 500 Internal Server Error in 29ms (ActiveRecord: 5.3ms | Allocations: 6290)


  
NameError (uninitialized constant ChatController::RedisService

        redis = RedisService.new
                ^^^^^^^^^^^^):
  
app/controllers/chat_controller.rb:33:in `new_chat_number'
app/controllers/chat_controller.rb:13:in `post'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 00:36:12 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (6.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (1.4ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 22:36:12.502090', '2022-11-22 22:36:12.502090', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.6ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (5.7ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 500 Internal Server Error in 118ms (ActiveRecord: 40.7ms | Allocations: 26104)


  
NameError (uninitialized constant ChatController::ChatWorker

        ChatWorker.perform_async(@app.id, @app.token, @chat.number)
        ^^^^^^^^^^):
  
app/controllers/chat_controller.rb:15:in `post'
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/sidekiq" for ::1 at 2022-11-23 01:09:03 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Started GET "/sidekiq/stylesheets/bootstrap.css" for ::1 at 2022-11-23 01:09:03 +0200
Started GET "/sidekiq/stylesheets/application.css" for ::1 at 2022-11-23 01:09:03 +0200
Started GET "/sidekiq/stylesheets/application-dark.css" for ::1 at 2022-11-23 01:09:03 +0200
Started GET "/sidekiq/javascripts/application.js" for ::1 at 2022-11-23 01:09:03 +0200
Started GET "/sidekiq/javascripts/dashboard.js" for ::1 at 2022-11-23 01:09:03 +0200
Started GET "/sidekiq/images/status.png" for ::1 at 2022-11-23 01:09:03 +0200
Started GET "/sidekiq/images/favicon.ico" for ::1 at 2022-11-23 01:09:03 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:09:08 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:09:13 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:09:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:09:24 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:09:28 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:09:34 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:09:39 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:09:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:09:49 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:09:54 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:09:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:03 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:14 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:18 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:24 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:28 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:34 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:39 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:49 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:54 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:10:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:11:04 +0200
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 01:11:08 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (2.2ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 23:11:08.281779', '2022-11-22 23:11:08.281779', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (1.3ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 500 Internal Server Error in 71ms (ActiveRecord: 28.4ms | Allocations: 25951)


  
NameError (uninitialized constant ChatController::ChatWorker

        ChatWorker.perform_async(@app.id, @app.token, @chat.number)
        ^^^^^^^^^^):
  
app/controllers/chat_controller.rb:15:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:11:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:11:14 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:11:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:11:23 +0200
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:11:34 +0200
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 01:11:34 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (1.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (1.0ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 23:11:34.204820', '2022-11-22 23:11:34.204820', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.5ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 201 Created in 49ms (Views: 0.2ms | ActiveRecord: 16.3ms | Allocations: 24364)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:11:39 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:11:43 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:11:48 +0200
Started GET "/sidekiq/queues" for ::1 at 2022-11-23 01:11:50 +0200
Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 01:13:07 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (2.0ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
  [1m[36mChat Load (10.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:20:in `get_chats'
Completed 200 OK in 28ms (Views: 0.6ms | ActiveRecord: 12.5ms | Allocations: 3006)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 01:13:24 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
  [1m[36mChat Load (0.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:20:in `get_chats'
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 1.3ms | Allocations: 1851)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 01:13:28 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (3.7ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 23:13:28.199559', '2022-11-22 23:13:28.199559', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (1.9ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 201 Created in 42ms (Views: 0.2ms | ActiveRecord: 9.8ms | Allocations: 4032)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 01:13:32 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (1.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
  [1m[36mChat Load (1.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:20:in `get_chats'
Completed 200 OK in 14ms (Views: 0.6ms | ActiveRecord: 2.4ms | Allocations: 1881)


Started GET "/sidekiq/" for ::1 at 2022-11-23 01:14:18 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:14:23 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:14:30 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:14:35 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:14:40 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:14:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:14:50 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:14:54 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:00 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:04 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:10 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:14 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:20 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:24 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:30 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:34 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:39 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:50 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:15:54 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:00 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:04 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:10 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:14 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:20 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:24 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:30 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:34 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:40 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:50 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:16:54 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:00 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:04 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:10 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:15 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:25 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:29 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:35 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:39 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:45 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:49 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:55 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:17:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:15 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:25 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:29 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:35 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:39 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:45 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:49 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:55 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:18:59 +0200
Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 01:19:01 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (8.1ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:37:in `set_app'
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:20:in `get_chats'
Completed 200 OK in 49ms (Views: 0.3ms | ActiveRecord: 30.7ms | Allocations: 10334)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 01:19:04 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (1.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (1.7ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-22 23:19:04.423547', '2022-11-22 23:19:04.423547', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (1.6ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 201 Created in 19ms (Views: 0.2ms | ActiveRecord: 6.9ms | Allocations: 5058)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:15 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:25 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:29 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:35 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:39 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:45 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:49 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:55 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:19:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:20:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:20:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:20:15 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:20:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:20:25 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:20:29 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:20:35 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:20:38 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:21:46 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:22:56 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:23:51 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:28:49 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 01:59:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 04:39:21 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 05:25:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 07:24:42 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 08:09:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 08:41:39 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 09:26:51 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 09:59:29 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:14:54 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:29:36 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:30:28 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:32:10 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:32:58 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:34:13 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:35:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:36:16 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:37:04 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:37:58 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:39:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:40:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:41:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:42:02 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:42:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:44:12 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:45:14 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:46:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:47:17 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:48:18 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:49:13 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:50:07 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:51:08 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:52:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:53:00 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:54:00 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:55:01 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:56:01 +0200
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:57:14 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:58:00 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 10:59:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:00:16 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:01:15 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:02:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:02:58 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:03:58 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:05:08 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:06:04 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:06:58 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:07:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:08:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:10:00 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:10:58 +0200
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:11:10 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (1.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:41:in `set_app'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (1.1ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-23 09:11:10.968804', '2022-11-23 09:11:10.968804', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.7ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 201 Created in 20ms (Views: 0.3ms | ActiveRecord: 6.3ms | Allocations: 4227)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:12:26 +0200
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:12:52 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (1.5ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-23 09:12:52.460966', '2022-11-23 09:12:52.460966', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.5ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:14:in `post'
  [1m[36mChat Update (3.8ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`number` = 7, `chats`.`updated_at` = '2022-11-23 09:12:52.468388' WHERE `chats`.`id` = 17[0m
  â†³ app/controllers/chat_controller.rb:14:in `post'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:14:in `post'
Completed 201 Created in 56ms (Views: 0.2ms | ActiveRecord: 36.0ms | Allocations: 14482)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:13:12 +0200
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (19.4ms)[0m  [1m[35mDROP INDEX `index_messages_on_chat_number` ON `messages`[0m
  [1m[35m (10.9ms)[0m  [1m[35mDROP INDEX `index_messages_on_number_and_chat_number` ON `messages`[0m
  [1m[35m (11.1ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (19.6ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (18.8ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (10.3ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (19.3ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (41.4ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (14.6ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (14.2ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (26.2ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (19.5ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (17.7ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (5.1ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (15.0ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (29.3ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.9ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (20.3ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (5.3ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (2.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (8.5ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (7.9ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL)[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (9.7ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (24.6ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (9.9ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (11.2ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (4.2ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (9.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (7.1ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (6.2ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (18.1ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (25.3ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (11.6ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (13.7ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (8.7ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (7.2ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (7.1ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (5.0ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number_and_chat_number` ON `messages` (`number`, `chat_number`)[0m
  [1m[35m (5.5ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_number` ON `messages` (`chat_number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 11:14:17 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:6:in `index'
Completed 200 OK in 8ms (Views: 0.4ms | ActiveRecord: 0.9ms | Allocations: 4488)


Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 11:14:20 +0200
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
Can't verify CSRF token authenticity.
Completed 422 Unprocessable Entity in 1ms (ActiveRecord: 0.0ms | Allocations: 539)


  
ActionController::InvalidAuthenticityToken (Can't verify CSRF token authenticity.):
  
actionpack (7.0.4) lib/action_controller/metal/request_forgery_protection.rb:251:in `handle_unverified_request'
actionpack (7.0.4) lib/action_controller/metal/request_forgery_protection.rb:284:in `handle_unverified_request'
actionpack (7.0.4) lib/action_controller/metal/request_forgery_protection.rb:273:in `verify_authenticity_token'
activesupport (7.0.4) lib/active_support/callbacks.rb:400:in `block in make_lambda'
activesupport (7.0.4) lib/active_support/callbacks.rb:199:in `block (2 levels) in halting'
actionpack (7.0.4) lib/abstract_controller/callbacks.rb:34:in `block (2 levels) in <module:Callbacks>'
activesupport (7.0.4) lib/active_support/callbacks.rb:200:in `block in halting'
activesupport (7.0.4) lib/active_support/callbacks.rb:595:in `block in invoke_before'
activesupport (7.0.4) lib/active_support/callbacks.rb:595:in `each'
activesupport (7.0.4) lib/active_support/callbacks.rb:595:in `invoke_before'
activesupport (7.0.4) lib/active_support/callbacks.rb:116:in `block in run_callbacks'
activesupport (7.0.4) lib/active_support/callbacks.rb:138:in `run_callbacks'
actionpack (7.0.4) lib/abstract_controller/callbacks.rb:233:in `process_action'
actionpack (7.0.4) lib/action_controller/metal/rescue.rb:22:in `process_action'
actionpack (7.0.4) lib/action_controller/metal/instrumentation.rb:67:in `block in process_action'
activesupport (7.0.4) lib/active_support/notifications.rb:206:in `block in instrument'
activesupport (7.0.4) lib/active_support/notifications/instrumenter.rb:24:in `instrument'
activesupport (7.0.4) lib/active_support/notifications.rb:206:in `instrument'
actionpack (7.0.4) lib/action_controller/metal/instrumentation.rb:66:in `process_action'
actionpack (7.0.4) lib/action_controller/metal/params_wrapper.rb:259:in `process_action'
activerecord (7.0.4) lib/active_record/railties/controller_runtime.rb:27:in `process_action'
actionpack (7.0.4) lib/abstract_controller/base.rb:151:in `process'
actionview (7.0.4) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.4) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.4) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.4) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.4) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.4) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.4) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.4) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.4) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.4) lib/rack/tempfile_reaper.rb:15:in `call'
rack (2.2.4) lib/rack/etag.rb:27:in `call'
rack (2.2.4) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.4) lib/rack/head.rb:12:in `call'
actionpack (7.0.4) lib/action_dispatch/http/permissions_policy.rb:38:in `call'
actionpack (7.0.4) lib/action_dispatch/http/content_security_policy.rb:36:in `call'
rack (2.2.4) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.4) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/cookies.rb:696:in `call'
activerecord (7.0.4) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.4) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.4) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
web-console (4.2.0) lib/web_console/middleware.rb:132:in `call_app'
web-console (4.2.0) lib/web_console/middleware.rb:28:in `block in call'
web-console (4.2.0) lib/web_console/middleware.rb:17:in `catch'
web-console (4.2.0) lib/web_console/middleware.rb:17:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/show_exceptions.rb:26:in `call'
railties (7.0.4) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.4) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.4) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.4) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.4) lib/rack/method_override.rb:24:in `call'
rack (2.2.4) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.4) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.4) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.4) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.4) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
railties (7.0.4) lib/rails/engine.rb:530:in `call'
puma (5.6.5) lib/puma/configuration.rb:252:in `call'
puma (5.6.5) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.5) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.5) lib/puma/request.rb:76:in `handle_request'
puma (5.6.5) lib/puma/server.rb:443:in `process_client'
puma (5.6.5) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 11:15:02 +0200
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (1.5ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('RgZmCTLkPZzzkmPd5nwGSc6Q', 'application 1', '2022-11-23 09:15:02', '2022-11-23 09:15:02')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 26ms (Views: 0.1ms | ActiveRecord: 16.3ms | Allocations: 9070)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:15:09 +0200
Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 11:15:10 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 1220)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:15:22 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'EHmJBfWNXWRa6GNZJt4zv1Sw' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 2230)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:15:34 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
  [1m[36mChat Load (1.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:21:in `get_chats'
Completed 200 OK in 31ms (Views: 0.1ms | ActiveRecord: 4.8ms | Allocations: 10711)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:15:40 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (0.5ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-23 09:15:40', '2022-11-23 09:15:40', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.5ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:14:in `post'
  [1m[36mChat Update (0.6ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`number` = 1 WHERE `chats`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:14:in `post'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:14:in `post'
Completed 201 Created in 27ms (Views: 0.2ms | ActiveRecord: 6.9ms | Allocations: 12709)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:15:48 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
  [1m[36mChat Load (4.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:21:in `get_chats'
Completed 200 OK in 12ms (Views: 0.3ms | ActiveRecord: 4.8ms | Allocations: 1479)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 11:16:02 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 0.8ms | Allocations: 745)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:16:03 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:17:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:18:21 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:19:13 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:20:15 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:21:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:22:07 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:23:03 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:24:08 +0200
Started GET "/create/chat?chat_number=1" for 127.0.0.1 at 2022-11-23 11:24:46 +0200
  
ActionController::RoutingError (No route matches [GET] "/create/chat"):
  
Started GET "/chat/messages?chat_number=1" for 127.0.0.1 at 2022-11-23 11:25:00 +0200
  
SyntaxError (/Users/marwahany/study/acm_sys/app/controllers/chat_controller.rb:26: syntax error, unexpected '\n', expecting =>
...eBlueprint,render_as_hash(msgs)
...                               ^
):
  
app/controllers/chat_controller.rb:26: syntax error, unexpected '\n', expecting =>
app/controllers/chat_controller.rb:26: syntax error, unexpected '\n', expecting =>
app/controllers/chat_controller.rb:26: syntax error, unexpected '\n', expecting =>
Started GET "/chat/messages?chat_number=1" for 127.0.0.1 at 2022-11-23 11:25:15 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"1"}
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` IS NULL AND `chats`.`application_token` IS NULL LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 8ms (Views: 0.2ms | ActiveRecord: 1.2ms | Allocations: 3691)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:25:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:26:16 +0200
Started GET "/chat/messages?chat_number=1" for 127.0.0.1 at 2022-11-23 11:26:24 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"1"}
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` IS NULL LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  â†³ app/controllers/chat_controller.rb:26:in `get_messages'
Completed 200 OK in 27ms (Views: 0.2ms | ActiveRecord: 14.6ms | Allocations: 8815)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:27:17 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:28:12 +0200
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:29:13 +0200
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:29:54 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (2.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (1.0ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-23 09:29:55', '2022-11-23 09:29:55', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.4ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 201 Created in 52ms (Views: 0.3ms | ActiveRecord: 27.2ms | Allocations: 12380)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.6ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (2, '2022-11-23 09:29:55', '2022-11-23 09:29:55', 1, 'RgZmCTLkPZzzkmPd5nwGSc6Q')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.3ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:30:14 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:31:12 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:32:04 +0200
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:32:27 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (0.7ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-23 09:32:27', '2022-11-23 09:32:27', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (0.5ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 201 Created in 19ms (Views: 0.5ms | ActiveRecord: 3.8ms | Allocations: 4132)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.5ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (3, '2022-11-23 09:32:27', '2022-11-23 09:32:27', 1, 'RgZmCTLkPZzzkmPd5nwGSc6Q')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (2.0ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:33:00 +0200
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:33:02 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mChat Create (3.3ms)[0m  [1m[32mINSERT INTO `chats` (`created_at`, `updated_at`, `app_id`) VALUES ('2022-11-23 09:33:02', '2022-11-23 09:33:02', 1)[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mApp Update All (2.5ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/chat_controller.rb:12:in `post'
Completed 201 Created in 42ms (Views: 0.2ms | ActiveRecord: 10.4ms | Allocations: 3870)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (1.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (1.3ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (4, '2022-11-23 09:33:02', '2022-11-23 09:33:02', 1, 'RgZmCTLkPZzzkmPd5nwGSc6Q')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.5ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:33:32 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (1.0ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 32ms (Views: 0.2ms | ActiveRecord: 18.8ms | Allocations: 9131)


  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.6ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (5, '2022-11-23 09:33:32', '2022-11-23 09:33:32', 1, 'RgZmCTLkPZzzkmPd5nwGSc6Q')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.4ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (6.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:34:13 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:35:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:35:58 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:36:58 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:38:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:39:00 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:40:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:41:01 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:41:58 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:42:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:44:03 +0200
Started GET "/chat/messages?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:44:11 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 12ms (Views: 0.2ms | ActiveRecord: 3.0ms | Allocations: 1569)


Started GET "/chat/messages?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 11:44:26 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (1.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 3[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 21ms (Views: 0.1ms | ActiveRecord: 7.4ms | Allocations: 9238)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:45:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:46:07 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:47:14 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:48:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:49:13 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:50:04 +0200
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (1.1ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (4.6ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (4, '2022-11-23 09:50:50', '2022-11-23 09:50:50', 1, 'EHmJBfWNXWRa6GNZJt4zv1Sw')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (4.3ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (3, '2022-11-23 09:51:05', '2022-11-23 09:51:05', 1, 'EHmJBfWNXWRa6GNZJt4zv1Sw')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:51:18 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:52:17 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:53:07 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:54:13 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:55:14 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:56:11 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:57:06 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:58:03 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 11:59:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:00:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:01:16 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:02:17 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:03:03 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:04:13 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:05:11 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:06:07 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:06:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:08:22 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:09:10 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:10:53 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:11:52 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:12:47 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:13:45 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:14:43 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:15:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:17:04 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:17:54 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:18:53 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:19:50 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:20:45 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 12:21:27 +0200
  
SyntaxError (/Users/marwahany/study/acm_sys/app/controllers/message_controller.rb:20: syntax error, unexpected ')', expecting '='
...ssage.number, @message.content))
...                              ^
/Users/marwahany/study/acm_sys/app/controllers/message_controller.rb:22: syntax error, unexpected `else', expecting ')'
            else
            ^~~~
/Users/marwahany/study/acm_sys/app/controllers/message_controller.rb:24: syntax error, unexpected `end', expecting ')'
            end
            ^~~
/Users/marwahany/study/acm_sys/app/controllers/message_controller.rb:27: syntax error, unexpected `end', expecting ')'
        end
        ^~~
/Users/marwahany/study/acm_sys/app/controllers/message_controller.rb:43: syntax error, unexpected `end', expecting ')'):
  
app/controllers/message_controller.rb:20: syntax error, unexpected ')', expecting '='
app/controllers/message_controller.rb:22: syntax error, unexpected `else', expecting ')'
app/controllers/message_controller.rb:24: syntax error, unexpected `end', expecting ')'
app/controllers/message_controller.rb:27: syntax error, unexpected `end', expecting ')'
app/controllers/message_controller.rb:43: syntax error, unexpected `end', expecting ')'
app/controllers/message_controller.rb:20: syntax error, unexpected ')', expecting '='
app/controllers/message_controller.rb:22: syntax error, unexpected `else', expecting ')'
app/controllers/message_controller.rb:24: syntax error, unexpected `end', expecting ')'
app/controllers/message_controller.rb:27: syntax error, unexpected `end', expecting ')'
app/controllers/message_controller.rb:43: syntax error, unexpected `end', expecting ')'
app/controllers/message_controller.rb:20: syntax error, unexpected ')', expecting '='
app/controllers/message_controller.rb:22: syntax error, unexpected `else', expecting ')'
app/controllers/message_controller.rb:24: syntax error, unexpected `end', expecting ')'
app/controllers/message_controller.rb:27: syntax error, unexpected `end', expecting ')'
app/controllers/message_controller.rb:43: syntax error, unexpected `end', expecting ')'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:21:39 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 12:22:03 +0200
Processing by MessageController#post as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (4.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:36:in `set_chat'
Can't verify CSRF token authenticity.
Completed 500 Internal Server Error in 55ms (ActiveRecord: 21.5ms | Allocations: 15746)


  
NoMethodError (undefined method `render_as_hash' for Message:Class):
  
app/controllers/message_controller.rb:21:in `post'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mMessage Create (1.7ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (1, '2022-11-23 10:22:03.590695', '2022-11-23 10:22:03.590695', 3, 2)[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mChat Load (3.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mMessage Create (1.2ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (1, '2022-11-23 10:22:23.573713', '2022-11-23 10:22:23.573713', 3, 2)[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mChat Load (0.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (1, '2022-11-23 10:22:47.133010', '2022-11-23 10:22:47.133010', 3, 2)[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 12:22:51 +0200
Processing by MessageController#post as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:36:in `set_chat'
Can't verify CSRF token authenticity.
Completed 201 Created in 24ms (Views: 0.2ms | ActiveRecord: 11.9ms | Allocations: 10477)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mMessage Create (0.5ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (2, '2022-11-23 10:22:51.875400', '2022-11-23 10:22:51.875400', 3, 2)[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:23:05 +0200
Started GET "/chat/messages?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 12:23:11 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 3[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 1.4ms | Allocations: 2867)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mMessage Create (2.7ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (2, '2022-11-23 10:23:17.760260', '2022-11-23 10:23:17.760260', 3, 2)[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mMessage Create (0.7ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (1, '2022-11-23 10:23:39.871989', '2022-11-23 10:23:39.871989', 3, 2)[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mTRANSACTION (16.5ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mMessage Create (1.2ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (2, '2022-11-23 10:23:50.223219', '2022-11-23 10:23:50.223219', 3, 2)[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:6:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:23:53 +0200
Started GET "/chat/messages?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 12:24:18 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 3[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 24ms (Views: 0.2ms | ActiveRecord: 11.9ms | Allocations: 8959)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (2, '2022-11-23 10:24:24.304979', '2022-11-23 10:24:24.304979', 3, 2)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 12:24:30 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (1.0ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 16ms (Views: 0.4ms | ActiveRecord: 5.1ms | Allocations: 3006)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 12:24:35 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 0.5ms | Allocations: 736)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:24:52 +0200
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (2.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (1.1ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (1, '2022-11-23 10:25:33.074291', '2022-11-23 10:25:33.074291', 3, 2)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:25:49 +0200
  [1m[36mTRANSACTION (4.8ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (2.2ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (2, '2022-11-23 10:26:26.301010', '2022-11-23 10:26:26.301010', 3, 2)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:26:41 +0200
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (45.2ms)[0m  [1m[35mDROP INDEX `index_messages_on_chat_number` ON `messages`[0m
  [1m[35m (5.8ms)[0m  [1m[35mDROP INDEX `index_messages_on_number_and_chat_number` ON `messages`[0m
  [1m[35m (11.5ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (2.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (2.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (3.0ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (4, '2022-11-23 10:31:17', '2022-11-23 10:31:17', 1, 'EHmJBfWNXWRa6GNZJt4zv1Sw')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (1.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (2.7ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (3, '2022-11-23 10:32:17', '2022-11-23 10:32:17', 1, 'EHmJBfWNXWRa6GNZJt4zv1Sw')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (36.1ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (13.2ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (5.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.9ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 12:50:59 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by MessageController#post as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:36:in `set_chat'
Can't verify CSRF token authenticity.
Completed 201 Created in 42ms (Views: 0.2ms | ActiveRecord: 14.3ms | Allocations: 22255)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:51:40 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 12:52:43 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 12:52:51 +0200
Processing by MessageController#post as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:37:in `set_chat'
Completed 201 Created in 32ms (Views: 0.2ms | ActiveRecord: 12.9ms | Allocations: 10570)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.7ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (4, '2022-11-23 10:52:51.834487', '2022-11-23 10:52:51.834487', 3, 2)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mMessage Load (0.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages`[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (1.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (1.8ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (2, '2022-11-23 11:12:53.082385', '2022-11-23 11:12:53.082385', 3, 2)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (2.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (2.6ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `chat_number`) VALUES (1, '2022-11-23 11:13:15.176345', '2022-11-23 11:13:15.176345', 3, 2)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Load (1.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:14:06 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by MessageController#post as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:35:in `set_chat'
Completed 500 Internal Server Error in 27ms (ActiveRecord: 8.9ms | Allocations: 15309)


  
NameError (undefined local variable or method `chat' for #<MessageController:0x0000000000c940>

        if chat.present?
           ^^^^
Did you mean?  @chat):
  
app/controllers/message_controller.rb:16:in `post'
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:14:15 +0200
Processing by MessageController#post as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:35:in `set_chat'
Completed 500 Internal Server Error in 25ms (ActiveRecord: 7.7ms | Allocations: 10981)


  
NameError (undefined local variable or method `message_params' for #<MessageController:0x00000000010bf8>

            @message = @chat.messages.build(message_params)
                                            ^^^^^^^^^^^^^^
Did you mean?  message_show_path):
  
app/controllers/message_controller.rb:17:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:14:31 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:15:07 +0200
Processing by MessageController#post as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
Completed 400 Bad Request in 20ms (ActiveRecord: 11.3ms | Allocations: 7233)


  
ActionController::ParameterMissing (param is missing or the value is empty: message):
  
app/controllers/message_controller.rb:31:in `message_params'
app/controllers/message_controller.rb:17:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:15:18 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:15:59 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
Completed 400 Bad Request in 8ms (ActiveRecord: 0.6ms | Allocations: 1085)


  
ActionController::ParameterMissing (param is missing or the value is empty: message):
  
app/controllers/message_controller.rb:31:in `message_params'
app/controllers/message_controller.rb:17:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:16:17 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:16:24 +0200
Processing by MessageController#post as */*
  Parameters: {"message"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
Completed 500 Internal Server Error in 12ms (ActiveRecord: 1.8ms | Allocations: 2624)


  
NoMethodError (undefined method `permit' for "HELLO WORLD MSG":String

        params.require(:message).permit(:content)
                                ^^^^^^^):
  
app/controllers/message_controller.rb:31:in `message_params'
app/controllers/message_controller.rb:17:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:17:29 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:17:39 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
Completed 400 Bad Request in 5ms (ActiveRecord: 0.6ms | Allocations: 1016)


  
ActionController::ParameterMissing (param is missing or the value is empty: message):
  
app/controllers/message_controller.rb:31:in `message_params'
app/controllers/message_controller.rb:17:in `post'
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:18:23 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
Completed 400 Bad Request in 23ms (ActiveRecord: 13.9ms | Allocations: 7211)


  
ActionController::ParameterMissing (param is missing or the value is empty: message):
  
app/controllers/message_controller.rb:31:in `message_params'
app/controllers/message_controller.rb:17:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:18:26 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:18:38 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
Completed 400 Bad Request in 6ms (ActiveRecord: 1.0ms | Allocations: 1070)


  
ActionController::ParameterMissing (param is missing or the value is empty: message):
  
app/controllers/message_controller.rb:31:in `message_params'
app/controllers/message_controller.rb:17:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:19:19 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:20:20 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:20:47 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
Completed 400 Bad Request in 46ms (ActiveRecord: 34.9ms | Allocations: 7209)


  
ActionController::ParameterMissing (param is missing or the value is empty: message):
  
app/controllers/message_controller.rb:31:in `message_params'
app/controllers/message_controller.rb:17:in `post'
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:21:07 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
Completed 500 Internal Server Error in 18ms (ActiveRecord: 8.8ms | Allocations: 8841)


  
NoMethodError (undefined method `permit' for "HELLO WORLD MSG":String

        params.require(:content).permit(:content)
                                ^^^^^^^):
  
app/controllers/message_controller.rb:31:in `message_params'
app/controllers/message_controller.rb:17:in `post'
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:21:19 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
Completed 500 Internal Server Error in 26ms (ActiveRecord: 14.4ms | Allocations: 10916)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/message_controller.rb:17:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:21:30 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:22:21 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
Completed 500 Internal Server Error in 20ms (ActiveRecord: 9.6ms | Allocations: 8781)


  
NoMethodError (undefined method `permit' for "HELLO WORLD MSG":String

        params.require(:content).permit(:content)
                                ^^^^^^^):
  
app/controllers/message_controller.rb:31:in `message_params'
app/controllers/message_controller.rb:17:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:22:40 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:23:10 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
Completed 400 Bad Request in 20ms (ActiveRecord: 11.9ms | Allocations: 7212)


  
ActionController::ParameterMissing (param is missing or the value is empty: message):
  
app/controllers/message_controller.rb:31:in `message_params'
app/controllers/message_controller.rb:17:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:23:35 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:24:35 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:25:33 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:26:33 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:26:59 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (2.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:37:in `set_chat'
Completed 500 Internal Server Error in 59ms (ActiveRecord: 28.5ms | Allocations: 12922)


  
NoMethodError (undefined method `[]' for #<StringIO:0x0000000114d5f588>

            @message.content = request.body[:content]
                                           ^^^^^^^^^^):
  
app/controllers/message_controller.rb:19:in `post'
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:27:11 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:37:in `set_chat'
Completed 500 Internal Server Error in 30ms (ActiveRecord: 17.0ms | Allocations: 11479)


  
NoMethodError (undefined method `content' for #<StringIO:0x00000001162d88d8>

            @message.content = request.body.content
                                           ^^^^^^^^):
  
app/controllers/message_controller.rb:19:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:27:25 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:28:24 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:29:12 +0200
Processing by MessageController#post as */*
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:37:in `set_chat'
Completed 500 Internal Server Error in 6ms (ActiveRecord: 0.8ms | Allocations: 2617)


  
NoMethodError (undefined method `content' for #<StringIO:0x0000000115c80cd8>

            @message.content = request.body.content
                                           ^^^^^^^^):
  
app/controllers/message_controller.rb:19:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:29:20 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:30:16 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (8.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:37:in `set_chat'
Completed 500 Internal Server Error in 33ms (ActiveRecord: 8.0ms | Allocations: 2491)


  
NoMethodError (undefined method `content' for #<StringIO:0x00000001166a1c30>

            @message.content = request.body.content
                                           ^^^^^^^^):
  
app/controllers/message_controller.rb:19:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:30:33 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:30:38 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (12.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:37:in `set_chat'
Completed 201 Created in 39ms (Views: 0.3ms | ActiveRecord: 23.4ms | Allocations: 10953)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:30:51 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:37:in `set_chat'
Completed 500 Internal Server Error in 35ms (ActiveRecord: 17.9ms | Allocations: 10107)


  
TypeError (no implicit conversion of Symbol into Integer):
  
app/controllers/message_controller.rb:19:in `[]'
app/controllers/message_controller.rb:19:in `post'
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:31:07 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:37:in `set_chat'
Completed 500 Internal Server Error in 26ms (ActiveRecord: 14.6ms | Allocations: 11756)


  
NoMethodError (undefined method `content' for "{\n    \"content\": \"HELLO WORLD MSG\"\n}":String

            @message.content = request.body.read.content
                                                ^^^^^^^^
Did you mean?  constantize):
  
app/controllers/message_controller.rb:19:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:31:38 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:31:41 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:37:in `set_chat'
Completed 201 Created in 23ms (Views: 0.2ms | ActiveRecord: 10.1ms | Allocations: 10620)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:32:35 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:33:37 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:34:36 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:35:33 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:36:19 +0200
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (1.8ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (4, '2022-11-23 11:42:20', '2022-11-23 11:42:20', 1, 'EHmJBfWNXWRa6GNZJt4zv1Sw')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.8ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (3, '2022-11-23 11:42:20', '2022-11-23 11:42:20', 1, 'EHmJBfWNXWRa6GNZJt4zv1Sw')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:43:22 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:43:27 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:37:in `set_chat'
Completed 500 Internal Server Error in 20ms (ActiveRecord: 0.9ms | Allocations: 9906)


  
SyntaxError (/Users/marwahany/study/acm_sys/app/workers/message_worker.rb:12: syntax error, unexpected local variable or method, expecting ')'
          content: body,
          ^~~~~~~
):
  
app/workers/message_worker.rb:12: syntax error, unexpected local variable or method, expecting ')'
app/workers/message_worker.rb:12: syntax error, unexpected local variable or method, expecting ')'
app/workers/message_worker.rb:12: syntax error, unexpected local variable or method, expecting ')'
app/controllers/message_controller.rb:21:in `post'
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:43:44 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:37:in `set_chat'
Completed 201 Created in 27ms (Views: 0.2ms | ActiveRecord: 11.5ms | Allocations: 10766)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.2ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (1.1ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('{\n    \"content\": \"HELLO WORLD MSG\"\n}', 10, '2022-11-23 11:43:44.309029', '2022-11-23 11:43:44.309029', 3, 'RgZmCTLkPZzzkmPd5nwGSc6Q', 2)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (1.1ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 3[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:44:29 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:45:23 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:46:17 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:46:33 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (6.2ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x0000000115e9ad20>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 41ms (Views: 0.3ms | ActiveRecord: 19.4ms | Allocations: 10775)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.7ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 11, '2022-11-23 11:46:34.079288', '2022-11-23 11:46:34.079288', 3, 'RgZmCTLkPZzzkmPd5nwGSc6Q', 2)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.6ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 3[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:47:00 +0200
Processing by MessageController#post as JSON
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x000000011619a9f8>, params: {"chat_number"=>"2", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 1301)


  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES (12, '2022-11-23 11:47:00.862675', '2022-11-23 11:47:00.862675', 3, 'RgZmCTLkPZzzkmPd5nwGSc6Q', 2)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/chat/messages?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:47:25 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 3[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 5ms (Views: 0.2ms | ActiveRecord: 1.3ms | Allocations: 2986)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:47:34 +0200
Started GET "/chat/messages?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 13:47:52 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (2.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 3[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 10ms (Views: 0.3ms | ActiveRecord: 2.9ms | Allocations: 1324)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:48:36 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:49:35 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:50:30 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 13:59:06 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:00:18 +0200
Started POST "/create/message?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 14:00:42 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:39:in `set_chat'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x00000001154e1158>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"2", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 19ms (Views: 0.2ms | ActiveRecord: 2.2ms | Allocations: 10247)


  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 3 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.7ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 13, '2022-11-23 12:00:42.850677', '2022-11-23 12:00:42.850677', 3, 'RgZmCTLkPZzzkmPd5nwGSc6Q', 2)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.4ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 3[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:01:16 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:02:13 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:03:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:04:01 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:05:07 +0200
Started GET "/chat/messages?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 14:06:19 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (1.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 3[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 42ms (Views: 0.2ms | ActiveRecord: 20.0ms | Allocations: 11236)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:06:26 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:07:17 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:08:16 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:09:13 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:10:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:11:03 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:12:02 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:13:03 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:14:08 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:15:22 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:16:00 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:17:01 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:18:01 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:19:01 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:20:07 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:21:11 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:22:07 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:23:06 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:24:06 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:33:57 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:34:54 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:48:35 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:49:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:50:46 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:51:31 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:52:45 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 14:53:40 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:02:32 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:08:45 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:09:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:10:45 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:11:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:13:06 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:13:59 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:15:01 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:15:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:16:53 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:17:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:18:49 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:19:47 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:20:46 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:21:46 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:23:02 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:23:44 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:25:04 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:27:22 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:28:23 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:29:17 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:30:16 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:31:24 +0200
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (1.8ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (4, '2022-11-23 13:32:00', '2022-11-23 13:32:00', 1, 'EHmJBfWNXWRa6GNZJt4zv1Sw')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:32:17 +0200
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.7ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (3, '2022-11-23 13:35:08', '2022-11-23 13:35:08', 1, 'EHmJBfWNXWRa6GNZJt4zv1Sw')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:35:53 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:36:52 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:37:42 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 15:39:00 +0200
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/message/show?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 16:18:46 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:41:in `set_chat'
Completed 500 Internal Server Error in 32ms (ActiveRecord: 12.8ms | Allocations: 12873)


  
SyntaxError (/Users/marwahany/study/acm_sys/app/models/message.rb:29: syntax error, unexpected symbol literal, expecting `do' or '{' or '('
...   indexes :chat_number, type :integer
...                              ^
/Users/marwahany/study/acm_sys/app/models/message.rb:30: syntax error, unexpected symbol literal, expecting `do' or '{' or '('
...        indexes :number, type :integer
...                              ^
):
  
app/models/message.rb:29: syntax error, unexpected symbol literal, expecting `do' or '{' or '('
app/models/message.rb:30: syntax error, unexpected symbol literal, expecting `do' or '{' or '('
app/models/message.rb:29: syntax error, unexpected symbol literal, expecting `do' or '{' or '('
app/models/message.rb:30: syntax error, unexpected symbol literal, expecting `do' or '{' or '('
app/models/message.rb:29: syntax error, unexpected symbol literal, expecting `do' or '{' or '('
app/models/message.rb:30: syntax error, unexpected symbol literal, expecting `do' or '{' or '('
app/controllers/message_controller.rb:46:in `set_message'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:18:51 +0200
Started GET "/message/show?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 16:19:47 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:41:in `set_chat'
  [1m[36mMessage Load (0.9ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:46:in `set_message'
Completed 500 Internal Server Error in 138ms (ActiveRecord: 17.7ms | Allocations: 12246)


  
Elasticsearch::Transport::Transport::Errors::BadRequest ([400] {"error":{"root_cause":[{"type":"parsing_exception","reason":"[match] unknown token [VALUE_NULL] after [query]","line":1,"col":52}],"type":"x_content_parse_exception","reason":"[1:52] [bool] failed to parse field [must]","caused_by":{"type":"parsing_exception","reason":"[match] unknown token [VALUE_NULL] after [query]","line":1,"col":52}},"status":400}):
  
app/controllers/message_controller.rb:10:in `get'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:20:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:21:07 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:22:07 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:23:03 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:24:06 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:25:06 +0200
Started GET "/message/show?chat_number=2&application_token=[FILTERED]&query=chat_number:2,application_token:RgZmCTLkPZzzkmPd5nwGSc6Q" for 127.0.0.1 at 2022-11-23 16:25:09 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]", "query"=>"chat_number:2,application_token:RgZmCTLkPZzzkmPd5nwGSc6Q"}
  [1m[36mChat Load (2.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:41:in `set_chat'
  [1m[36mMessage Load (6.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:46:in `set_message'
Completed 500 Internal Server Error in 70ms (ActiveRecord: 8.9ms | Allocations: 2553)


  
Elasticsearch::Transport::Transport::Errors::NotFound ([404] {"error":{"root_cause":[{"type":"index_not_found_exception","reason":"no such index [messages]","resource.type":"index_or_alias","resource.id":"messages","index_uuid":"_na_","index":"messages"}],"type":"index_not_found_exception","reason":"no such index [messages]","resource.type":"index_or_alias","resource.id":"messages","index_uuid":"_na_","index":"messages"},"status":404}):
  
app/controllers/message_controller.rb:10:in `get'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:26:05 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:26:50 +0200
Started GET "/chat/messages?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 16:27:21 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (2.2ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (2.5ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 3[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 43ms (Views: 0.8ms | ActiveRecord: 18.3ms | Allocations: 8344)


Started GET "/message/show?chat_number=2&application_token=[FILTERED]&query=HELLO%20WORLD%20MSG" for 127.0.0.1 at 2022-11-23 16:27:33 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]", "query"=>"HELLO WORLD MSG"}
  [1m[36mChat Load (0.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:41:in `set_chat'
  [1m[36mMessage Load (2.0ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:46:in `set_message'
Completed 500 Internal Server Error in 75ms (ActiveRecord: 2.9ms | Allocations: 2608)


  
Elasticsearch::Transport::Transport::Errors::NotFound ([404] {"error":{"root_cause":[{"type":"index_not_found_exception","reason":"no such index [messages]","resource.type":"index_or_alias","resource.id":"messages","index_uuid":"_na_","index":"messages"}],"type":"index_not_found_exception","reason":"no such index [messages]","resource.type":"index_or_alias","resource.id":"messages","index_uuid":"_na_","index":"messages"},"status":404}):
  
app/controllers/message_controller.rb:10:in `get'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:28:01 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:28:57 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:29:50 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:31:09 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:32:01 +0200
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (24.7ms)[0m  [1m[35mDROP INDEX `index_messages_on_application_token_and_chat_number` ON `messages`[0m
  [1m[35m (6.7ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[35m (4.6ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (26.8ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (17.2ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (6.7ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (21.9ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (25.0ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (11.4ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (34.9ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (23.4ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (2.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (19.4ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (30.6ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (4.0ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (15.4ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (14.2ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (9.2ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (2.0ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (2.5ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (10.6ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (19.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (31.0ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (28.1ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (7.0ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (17.7ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (4.4ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (15.2ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (55.6ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (5.9ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (4.9ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (7.8ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (5.7ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (11.2ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (10.5ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (7.2ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (7.3ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (9.3ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (5.2ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 16:33:40 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 8ms (Views: 0.3ms | ActiveRecord: 0.9ms | Allocations: 4449)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:34:03 +0200
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 16:34:10 +0200
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (0.5ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('cbJjHVY2AQcjBxtY3tNnPW4K', 'application 1', '2022-11-23 14:34:10', '2022-11-23 14:34:10')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (6.4ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 25ms (Views: 0.1ms | ActiveRecord: 16.5ms | Allocations: 7878)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 16:34:13 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 7ms (Views: 0.3ms | ActiveRecord: 0.6ms | Allocations: 867)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 16:34:26 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (1.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'cbJjHVY2AQcjBxtY3tNnPW4K' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 28ms (Views: 0.2ms | ActiveRecord: 5.5ms | Allocations: 11622)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.9ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (1, '2022-11-23 14:34:26', '2022-11-23 14:34:26', 1, 'cbJjHVY2AQcjBxtY3tNnPW4K')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.6ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 16:34:40 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'cbJjHVY2AQcjBxtY3tNnPW4K' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:41:in `set_chat'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x0000000113169180>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 500 Internal Server Error in 25ms (ActiveRecord: 4.4ms | Allocations: 14563)


  
NoMethodError (undefined method `body' for #<Message id: nil, content: "HELLO WORLD MSG", number: 1, created_at: nil, updated_at: nil, chat_id: 1, application_token: nil, chat_number: nil>):
  
app/controllers/message_controller.rb:22:in `post'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:35:04 +0200
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (17.4ms)[0m  [1m[35mDROP INDEX `index_messages_on_application_token_and_chat_number` ON `messages`[0m
  [1m[35m (10.3ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[35m (4.3ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (4.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (27.4ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (9.2ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (7.6ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (20.9ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (18.7ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (11.8ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (8.8ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (10.6ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (18.6ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (19.6ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (4.0ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (16.3ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (11.9ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.8ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (26.0ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (2.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (23.8ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.0ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (24.4ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (19.1ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL)[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (12.7ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (8.8ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (5.0ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (10.0ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (4.7ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (17.8ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (8.0ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (9.3ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (6.0ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (8.7ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (5.7ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (6.8ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (10.9ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (6.7ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (6.4ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 16:36:02 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (0.8ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('CsWeEUACxqBXbJLexvoGQQy3', 'application 1', '2022-11-23 14:36:02', '2022-11-23 14:36:02')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 23ms (Views: 0.2ms | ActiveRecord: 10.1ms | Allocations: 11200)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:36:02 +0200
Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 16:36:09 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 1309)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 16:36:30 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'CsWeEUACxqBXbJLexvoGQQy3' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 27ms (Views: 0.2ms | ActiveRecord: 9.8ms | Allocations: 11567)


  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.9ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (1, '2022-11-23 14:36:30', '2022-11-23 14:36:30', 1, 'CsWeEUACxqBXbJLexvoGQQy3')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.5ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 16:36:41 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'CsWeEUACxqBXbJLexvoGQQy3' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:41:in `set_chat'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x00000001109e03c0>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 19ms (Views: 0.2ms | ActiveRecord: 5.4ms | Allocations: 9355)


  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (2.0ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 1, '2022-11-23 14:36:41.892538', '2022-11-23 14:36:41.892538', 1, 'CsWeEUACxqBXbJLexvoGQQy3', 1)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.6ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/chat/messages?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 16:36:48 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'RgZmCTLkPZzzkmPd5nwGSc6Q' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 707)


Started GET "/chat/messages?chat_number=2&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 16:36:55 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"2", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 2 AND `chats`.`application_token` = 'CsWeEUACxqBXbJLexvoGQQy3' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 10ms (Views: 0.6ms | ActiveRecord: 0.6ms | Allocations: 643)


Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:36:59 +0200
Started GET "/chat/messages?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 16:36:59 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'CsWeEUACxqBXbJLexvoGQQy3' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (0.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.3ms | Allocations: 2163)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 16:37:16 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 733)


Started GET "/message/show?chat_number=1&application_token=[FILTERED]&query=HELLO%20WORLD%20MSG" for 127.0.0.1 at 2022-11-23 16:37:28 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "application_token"=>"[FILTERED]", "query"=>"HELLO WORLD MSG"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'CsWeEUACxqBXbJLexvoGQQy3' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:41:in `set_chat'
  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:46:in `set_message'
Completed 500 Internal Server Error in 124ms (ActiveRecord: 1.3ms | Allocations: 9816)


  
Elasticsearch::Transport::Transport::Errors::NotFound ([404] {"error":{"root_cause":[{"type":"index_not_found_exception","reason":"no such index [messages]","resource.type":"index_or_alias","resource.id":"messages","index_uuid":"_na_","index":"messages"}],"type":"index_not_found_exception","reason":"no such index [messages]","resource.type":"index_or_alias","resource.id":"messages","index_uuid":"_na_","index":"messages"},"status":404}):
  
app/controllers/message_controller.rb:10:in `get'
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:37:53 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:38:52 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:40:14 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:40:54 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:50:04 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:51:01 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:51:49 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:52:49 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:53:49 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:54:54 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:56:04 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 16:56:50 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 17:03:25 +0200
Started GET "/sidekiq/stats" for ::1 at 2022-11-23 17:04:40 +0200
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (28.1ms)[0m  [1m[35mDROP INDEX `index_messages_on_application_token_and_chat_number` ON `messages`[0m
  [1m[35m (9.7ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[35m (5.1ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.9ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (27.4ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (6.4ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (27.1ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (44.7ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (4.8ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (23.9ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (18.8ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (20.4ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (33.4ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (5.4ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (12.4ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (10.3ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (10.5ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.4ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (1.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (3.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (16.2ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (16.7ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (10.4ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (8.7ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (11.3ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (6.2ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (5.7ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (11.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (8.0ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (5.0ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (5.9ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (6.0ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (7.2ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (7.8ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (10.0ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (7.1ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (7.0ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (5.3ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 19:56:39 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
  [1m[36mApp Load (1.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 1.9ms | Allocations: 4449)


Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 19:56:48 +0200
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (1.0ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('1XBnxf65Jse8tDJr8bwQvRAz', 'application 1', '2022-11-23 17:56:48', '2022-11-23 17:56:48')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 25ms (Views: 0.1ms | ActiveRecord: 9.7ms | Allocations: 7891)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 19:56:51 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 0.6ms | Allocations: 868)


Started GET "/app/search/?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 19:57:06 +0200
Processing by AppController#get as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (1.1ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
Completed 200 OK in 11ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 7287)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 19:57:15 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (1.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:21:in `get_chats'
Completed 200 OK in 21ms (Views: 0.1ms | ActiveRecord: 4.3ms | Allocations: 5907)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 19:57:21 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 17ms (Views: 0.1ms | ActiveRecord: 2.4ms | Allocations: 7611)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (1.0ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (1, '2022-11-23 17:57:21', '2022-11-23 17:57:21', 1, '1XBnxf65Jse8tDJr8bwQvRAz')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.4ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 19:57:24 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (1.1ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:21:in `get_chats'
Completed 200 OK in 11ms (Views: 0.7ms | ActiveRecord: 1.7ms | Allocations: 1473)


Started GET "/chat/messages?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 19:57:37 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 35ms (Views: 0.1ms | ActiveRecord: 7.9ms | Allocations: 11146)


Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 19:57:47 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:41:in `set_chat'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x000000011305a898>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 13ms (Views: 0.2ms | ActiveRecord: 2.3ms | Allocations: 5576)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.9ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 1, '2022-11-23 17:57:47.972730', '2022-11-23 17:57:47.972730', 1, '1XBnxf65Jse8tDJr8bwQvRAz', 1)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (2.4ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/chat/messages?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 19:57:51 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (0.3ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1467)


Started GET "/message/show?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 19:57:56 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (2.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:41:in `set_chat'
  [1m[36mMessage Load (1.3ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:46:in `set_message'
Completed 500 Internal Server Error in 71ms (ActiveRecord: 3.2ms | Allocations: 4446)


  
Elasticsearch::Transport::Transport::Errors::BadRequest ([400] {"error":{"root_cause":[{"type":"parsing_exception","reason":"[match] unknown token [VALUE_NULL] after [query]","line":1,"col":52}],"type":"x_content_parse_exception","reason":"[1:52] [bool] failed to parse field [must]","caused_by":{"type":"parsing_exception","reason":"[match] unknown token [VALUE_NULL] after [query]","line":1,"col":52}},"status":400}):
  
app/controllers/message_controller.rb:10:in `get'
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 19:58:32 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:41:in `set_chat'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:46:in `set_message'
Completed 500 Internal Server Error in 35ms (ActiveRecord: 0.9ms | Allocations: 2610)


  
Elasticsearch::Transport::Transport::Errors::BadRequest ([400] {"error":{"root_cause":[{"type":"query_shard_exception","reason":"[match] analyzer [trigram] not found","index_uuid":"F6z-zRvhSG6YWSLHd2FPgQ","index":"messages"}],"type":"search_phase_execution_exception","reason":"all shards failed","phase":"query","grouped":true,"failed_shards":[{"shard":0,"index":"messages","node":"5evF7N-HRpeLLSnW1uAbGw","reason":{"type":"query_shard_exception","reason":"[match] analyzer [trigram] not found","index_uuid":"F6z-zRvhSG6YWSLHd2FPgQ","index":"messages"}}]},"status":400}):
  
app/controllers/message_controller.rb:10:in `get'
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 20:21:45 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_chat'
  [1m[36mMessage Load (2.0ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:55:in `set_message'
Completed 500 Internal Server Error in 112ms (ActiveRecord: 17.4ms | Allocations: 18351)


  
Elasticsearch::Transport::Transport::Errors::BadRequest ([400] {"error":{"root_cause":[{"type":"query_shard_exception","reason":"[match] analyzer [trigram] not found","index_uuid":"F6z-zRvhSG6YWSLHd2FPgQ","index":"messages"}],"type":"search_phase_execution_exception","reason":"all shards failed","phase":"query","grouped":true,"failed_shards":[{"shard":0,"index":"messages","node":"5evF7N-HRpeLLSnW1uAbGw","reason":{"type":"query_shard_exception","reason":"[match] analyzer [trigram] not found","index_uuid":"F6z-zRvhSG6YWSLHd2FPgQ","index":"messages"}}]},"status":400}):
  
app/controllers/message_controller.rb:18:in `get'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (26.9ms)[0m  [1m[35mDROP INDEX `index_messages_on_application_token_and_chat_number` ON `messages`[0m
  [1m[35m (7.6ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[35m (5.9ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (21.9ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (11.6ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (6.8ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (21.0ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.0ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (3.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (17.4ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (9.4ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (18.0ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (7.4ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (2.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (5.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (17.3ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (25.4ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (4.7ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (11.1ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (8.6ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (5.9ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (5.3ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (14.4ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (2.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (22.4ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (21.2ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (20.1ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (20.1ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (17.9ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (12.2ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (9.1ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (9.9ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (9.2ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (7.7ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (10.5ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (6.9ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (11.7ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (7.4ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (7.9ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (10.3ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (7.5ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (4.9ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 20:52:21 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (5.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_chat'
Completed 500 Internal Server Error in 25ms (ActiveRecord: 10.2ms | Allocations: 11421)


  
NameError (undefined local variable or method `not_found' for #<MessageController:0x0000000000c968>

        render json: { "error": 'Chat Not Found' }, status: not_found unless @chat
                                                            ^^^^^^^^^):
  
app/controllers/message_controller.rb:51:in `set_chat'
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 20:52:54 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 9ms (Views: 0.3ms | ActiveRecord: 3.7ms | Allocations: 4334)


Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:32:17 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (2.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 28ms (Views: 0.3ms | ActiveRecord: 3.1ms | Allocations: 4048)


Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:32:21 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = '1XBnxf65Jse8tDJr8bwQvRAz' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 4ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 779)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 21:32:46 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 1398)


Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 21:32:49 +0200
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (1.0ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('k2y2DLP2SMDVMM9pgvPx43FJ', 'application 1', '2022-11-23 19:32:49', '2022-11-23 19:32:49')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 22ms (Views: 0.1ms | ActiveRecord: 11.5ms | Allocations: 7607)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 21:32:52 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 0.6ms | Allocations: 842)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:33:03 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'k2y2DLP2SMDVMM9pgvPx43FJ' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 25ms (Views: 0.2ms | ActiveRecord: 3.6ms | Allocations: 9571)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (1.0ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (1, '2022-11-23 19:33:03', '2022-11-23 19:33:03', 1, 'k2y2DLP2SMDVMM9pgvPx43FJ')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.6ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started GET "/chat/messages?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:33:10 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'k2y2DLP2SMDVMM9pgvPx43FJ' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (1.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:50:in `<main>'
  [1m[36mMessage Load (2.0ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 268ms (Views: 0.9ms | ActiveRecord: 11.0ms | Allocations: 10621)


Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:33:16 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'k2y2DLP2SMDVMM9pgvPx43FJ' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x0000000113aece28>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 20ms (Views: 0.2ms | ActiveRecord: 1.6ms | Allocations: 5313)


  [1m[36mMessage Load (1.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:50:in `<main>'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.7ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 1, '2022-11-23 19:33:16.987088', '2022-11-23 19:33:16.987088', 1, 'k2y2DLP2SMDVMM9pgvPx43FJ', 1)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.6ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:33:22 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'k2y2DLP2SMDVMM9pgvPx43FJ' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.3ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 24ms (ActiveRecord: 0.8ms | Allocations: 5611)


  
NoMethodError (undefined method `partial_search' for Message:Class
Did you mean?  partial_inserts):
  
app/controllers/message_controller.rb:13:in `get'
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:35:22 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (3.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'k2y2DLP2SMDVMM9pgvPx43FJ' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:50:in `<main>'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 254ms (ActiveRecord: 42.4ms | Allocations: 16218)


  
NoMethodError (undefined method `number' for #<Elasticsearch::Model::Response::Response:0x00000001135854d0 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @search=#<Elasticsearch::Model::Searching::SearchRequest:0x0000000113585818 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @options={}, @definition={:index=>"messages", :type=>nil, :body=>{:query=>{:multi_match=>{:query=>"HELLO WORLD MSG", :fields=>["content"]}}, :highlight=>{:pre_tags=>["<em>"], :post_tags=>["</em>"], :fields=>{:content=>{}}}}}>>

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/message_controller.rb:15:in `get'
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:36:23 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'k2y2DLP2SMDVMM9pgvPx43FJ' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.3ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:51:in `<main>'
  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 182ms (ActiveRecord: 17.6ms | Allocations: 16117)


  
NoMethodError (undefined method `number' for #<Elasticsearch::Model::Response::Response:0x0000000112fe81a8 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @search=#<Elasticsearch::Model::Searching::SearchRequest:0x0000000112fe8a18 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @options={}, @definition={:index=>"messages", :type=>nil, :body=>{:query=>{:multi_match=>{:query=>"HELLO WORLD MSG", :fields=>["content"]}}, :highlight=>{:pre_tags=>["<em>"], :post_tags=>["</em>"], :fields=>{:content=>{}}}}}>>

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/message_controller.rb:15:in `get'
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:36:31 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'k2y2DLP2SMDVMM9pgvPx43FJ' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:51:in `<main>'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 227ms (ActiveRecord: 17.0ms | Allocations: 26331)


  
NoMethodError (undefined method `number' for #<Elasticsearch::Model::Response::Response:0x00000001110677e8 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @search=#<Elasticsearch::Model::Searching::SearchRequest:0x0000000111067a18 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @options={}, @definition={:index=>"messages", :type=>nil, :body=>{:query=>{:multi_match=>{:query=>"HELLO WORLD MSG", :fields=>["content"]}}, :highlight=>{:pre_tags=>["<em>"], :post_tags=>["</em>"], :fields=>{:content=>{}}}}}>>

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/message_controller.rb:15:in `get'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (26.5ms)[0m  [1m[35mDROP INDEX `index_messages_on_application_token_and_chat_number` ON `messages`[0m
  [1m[35m (11.4ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[35m (4.8ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (22.2ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (32.3ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (8.0ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (27.7ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (20.7ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (6.6ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (14.1ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (23.7ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (24.4ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (23.2ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (5.1ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (15.9ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.0ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (5.6ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (9.1ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (3.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (7.5ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (13.8ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (11.5ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL)[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (9.4ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (23.9ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (8.6ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (9.4ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (3.7ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.9ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (9.4ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (7.0ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (6.8ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (6.2ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (6.4ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (8.0ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (8.9ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (7.6ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (3.8ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (14.5ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (1.8ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 21:37:21 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (1.0ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('mCgwpQmj5zyv85AjePZtCyYY', 'application 1', '2022-11-23 19:37:21', '2022-11-23 19:37:21')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 24ms (Views: 0.2ms | ActiveRecord: 10.9ms | Allocations: 11203)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 21:37:23 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 1324)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:37:33 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'mCgwpQmj5zyv85AjePZtCyYY' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 29ms (Views: 0.2ms | ActiveRecord: 8.4ms | Allocations: 12614)


  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (2.0ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.5ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (1, '2022-11-23 19:37:33', '2022-11-23 19:37:33', 1, 'mCgwpQmj5zyv85AjePZtCyYY')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.4ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:37:42 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'mCgwpQmj5zyv85AjePZtCyYY' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.9ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:51:in `<main>'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x0000000112e41958>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 290ms (Views: 0.7ms | ActiveRecord: 8.7ms | Allocations: 14425)


  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:51:in `<main>'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 1, '2022-11-23 19:37:43.441126', '2022-11-23 19:37:43.441126', 1, 'mCgwpQmj5zyv85AjePZtCyYY', 1)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.5ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:37:47 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'mCgwpQmj5zyv85AjePZtCyYY' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 7ms (ActiveRecord: 1.2ms | Allocations: 2985)


  
NoMethodError (undefined method `number' for #<Elasticsearch::Model::Response::Response:0x0000000112fc6fa8 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @search=#<Elasticsearch::Model::Searching::SearchRequest:0x0000000112fc71d8 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @options={}, @definition={:index=>"messages", :type=>nil, :body=>{:query=>{:multi_match=>{:query=>"HELLO WORLD MSG", :fields=>["content"]}}, :highlight=>{:pre_tags=>["<em>"], :post_tags=>["</em>"], :fields=>{:content=>{}}}}}>>

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/message_controller.rb:15:in `get'
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:39:04 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'mCgwpQmj5zyv85AjePZtCyYY' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:51:in `<main>'
  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 181ms (ActiveRecord: 22.2ms | Allocations: 16213)


  
NoMethodError (undefined method `number' for #<Elasticsearch::Model::Response::Response:0x0000000113457900 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @search=#<Elasticsearch::Model::Searching::SearchRequest:0x0000000113457ae0 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @options={}, @definition={:index=>"messages", :type=>nil, :body=>{:query=>{:multi_match=>{:query=>"HELLO WORLD MSG", :fields=>["content", "number"]}}, :highlight=>{:pre_tags=>["<em>"], :post_tags=>["</em>"], :fields=>{:content=>{}}}}}>>

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/message_controller.rb:15:in `get'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (20.1ms)[0m  [1m[35mDROP INDEX `index_messages_on_application_token_and_chat_number` ON `messages`[0m
  [1m[35m (4.7ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[35m (5.5ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (23.9ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (11.1ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (7.2ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (22.0ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (47.3ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (10.4ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (15.7ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (19.2ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (15.5ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (47.4ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (5.5ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (15.9ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.4ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (12.7ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (3.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (6.5ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (5.7ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (16.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (16.8ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (11.3ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (5.5ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (10.2ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (4.2ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (10.5ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (10.0ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (14.7ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.7ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (19.8ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (24.7ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (7.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (26.0ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (8.3ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (13.8ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (9.1ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (7.5ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (4.9ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 21:40:19 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (1.0ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('Yft8yMzMMiZLNdbjG1RnMyFA', 'application 1', '2022-11-23 19:40:19', '2022-11-23 19:40:19')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (5.4ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 31ms (Views: 0.2ms | ActiveRecord: 18.2ms | Allocations: 11203)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 21:40:21 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 1324)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:40:28 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Yft8yMzMMiZLNdbjG1RnMyFA' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 27ms (Views: 0.2ms | ActiveRecord: 6.6ms | Allocations: 12614)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (1.5ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (1, '2022-11-23 19:40:28', '2022-11-23 19:40:28', 1, 'Yft8yMzMMiZLNdbjG1RnMyFA')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.4ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (9.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started GET "/chat/messages?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:40:33 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'Yft8yMzMMiZLNdbjG1RnMyFA' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (1.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:51:in `<main>'
  [1m[36mMessage Load (1.0ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 265ms (Views: 0.2ms | ActiveRecord: 8.7ms | Allocations: 11205)


Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:40:39 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'Yft8yMzMMiZLNdbjG1RnMyFA' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x0000000112995378>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 8ms (Views: 0.2ms | ActiveRecord: 0.9ms | Allocations: 5534)


  [1m[36mMessage Load (0.9ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:51:in `<main>'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 1, '2022-11-23 19:40:39.566250', '2022-11-23 19:40:39.566250', 1, 'Yft8yMzMMiZLNdbjG1RnMyFA', 1)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.5ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:40:46 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'Yft8yMzMMiZLNdbjG1RnMyFA' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (2.9ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 17ms (ActiveRecord: 3.6ms | Allocations: 2969)


  
NoMethodError (undefined method `number' for #<Elasticsearch::Model::Response::Response:0x0000000112a5e0e8 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @search=#<Elasticsearch::Model::Searching::SearchRequest:0x0000000112a5e318 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @options={}, @definition={:index=>"messages", :type=>nil, :body=>{:query=>{:multi_match=>{:query=>"HELLO WORLD MSG", :fields=>["content", "number"]}}, :highlight=>{:pre_tags=>["<em>"], :post_tags=>["</em>"], :fields=>{:content=>{}}}}}>>

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/message_controller.rb:15:in `get'
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:41:42 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'Yft8yMzMMiZLNdbjG1RnMyFA' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:51:in `<main>'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 183ms (ActiveRecord: 26.7ms | Allocations: 15829)


  
Elasticsearch::Transport::Transport::Errors::BadRequest ([400] {"error":{"root_cause":[{"type":"query_shard_exception","reason":"failed to create query: For input string: \"HELLO WORLD MSG\"","index_uuid":"QmDFNx5vTcauEqwrYMzlyg","index":"messages"}],"type":"search_phase_execution_exception","reason":"all shards failed","phase":"query","grouped":true,"failed_shards":[{"shard":0,"index":"messages","node":"5evF7N-HRpeLLSnW1uAbGw","reason":{"type":"query_shard_exception","reason":"failed to create query: For input string: \"HELLO WORLD MSG\"","index_uuid":"QmDFNx5vTcauEqwrYMzlyg","index":"messages","caused_by":{"type":"number_format_exception","reason":"For input string: \"HELLO WORLD MSG\""}}}]},"status":400}):
  
app/controllers/message_controller.rb:15:in `get'
Started GET "/message/show?chat_number=1&query=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 21:42:04 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "query"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'Yft8yMzMMiZLNdbjG1RnMyFA' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:51:in `<main>'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 166ms (ActiveRecord: 13.3ms | Allocations: 15588)


  
Elasticsearch::Transport::Transport::Errors::BadRequest ([400] {"error":{"root_cause":[{"type":"query_shard_exception","reason":"failed to create query: For input string: \"HELLO WORLD MSG\"","index_uuid":"ujiKkiioQCSs2qEgI5ii-w","index":"messages"}],"type":"search_phase_execution_exception","reason":"all shards failed","phase":"query","grouped":true,"failed_shards":[{"shard":0,"index":"messages","node":"5evF7N-HRpeLLSnW1uAbGw","reason":{"type":"query_shard_exception","reason":"failed to create query: For input string: \"HELLO WORLD MSG\"","index_uuid":"ujiKkiioQCSs2qEgI5ii-w","index":"messages","caused_by":{"type":"number_format_exception","reason":"For input string: \"HELLO WORLD MSG\""}}}]},"status":400}):
  
app/controllers/message_controller.rb:15:in `get'
Started GET "/message/show?chat_number=1&body=content:HELLO%20WORLD%20MSG,chat_number:&application_token" for 127.0.0.1 at 2022-11-23 22:05:59 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"content:HELLO WORLD MSG,chat_number:", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (2.2ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 24ms (Views: 7.6ms | ActiveRecord: 3.5ms | Allocations: 3669)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (24.7ms)[0m  [1m[35mDROP INDEX `index_messages_on_application_token_and_chat_number` ON `messages`[0m
  [1m[35m (10.6ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[35m (4.3ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (28.7ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (16.4ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (7.4ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (19.9ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (4.4ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (32.1ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (7.3ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (11.9ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (11.9ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (1.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (17.1ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (34.5ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (5.0ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (20.4ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (7.9ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (7.2ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (2.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (8.3ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.1ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (15.2ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (21.5ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (178.8ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (8.9ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (10.3ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (11.1ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (11.4ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (9.0ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (10.5ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (9.8ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (7.9ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (34.1ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (7.5ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (7.8ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (8.4ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (4.9ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (4.9ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (6.0ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 22:09:42 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (1.1ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('PjCgKtWKzXDEUpMsoHN9uAC1', 'application 1', '2022-11-23 20:09:42.527811', '2022-11-23 20:09:42.527811')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 25ms (Views: 0.2ms | ActiveRecord: 12.5ms | Allocations: 11153)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 22:09:45 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 1325)


Started GET "/app/search/?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:09:56 +0200
Processing by AppController#get as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (1.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
Completed 200 OK in 14ms (Views: 0.4ms | ActiveRecord: 1.3ms | Allocations: 2306)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:10:13 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (1.0ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
  [1m[36mChat Load (8.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:21:in `get_chats'
Completed 200 OK in 43ms (Views: 0.2ms | ActiveRecord: 12.3ms | Allocations: 10724)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:10:21 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 13ms (Views: 0.4ms | ActiveRecord: 1.8ms | Allocations: 7621)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.5ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (1, '2022-11-23 20:10:21', '2022-11-23 20:10:21', 1, 'PjCgKtWKzXDEUpMsoHN9uAC1')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.4ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:10:30 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (1.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
  [1m[36mChat Load (9.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:21:in `get_chats'
Completed 200 OK in 18ms (Views: 0.3ms | ActiveRecord: 10.9ms | Allocations: 1471)


Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:10:40 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (1.3ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:55:in `<main>'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x00000001109a3010>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 237ms (Views: 0.2ms | ActiveRecord: 8.3ms | Allocations: 14450)


  [1m[36mMessage Load (1.0ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:55:in `<main>'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.5ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 1, '2022-11-23 20:10:41.025521', '2022-11-23 20:10:41.025521', 1, 'PjCgKtWKzXDEUpMsoHN9uAC1', 1)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.5ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:10:45 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 1394)


Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:12:14 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (4.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:55:in `<main>'
  [1m[36mMessage Load (0.9ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 183ms (Views: 0.2ms | ActiveRecord: 29.1ms | Allocations: 14630)


Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:13:04 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.3ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:55:in `<main>'
  [1m[36mMessage Load (1.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 208ms (Views: 0.2ms | ActiveRecord: 17.1ms | Allocations: 14725)


Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:13:55 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (4.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:55:in `<main>'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 205ms (Views: 0.1ms | ActiveRecord: 21.6ms | Allocations: 14404)


Started GET "/chat/messages?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:16:03 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (2.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'Yft8yMzMMiZLNdbjG1RnMyFA' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 18ms (Views: 1.0ms | ActiveRecord: 2.7ms | Allocations: 896)


Started GET "/chat/messages?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:16:08 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (3.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (1.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 22ms (Views: 0.1ms | ActiveRecord: 4.7ms | Allocations: 3275)


Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:16:41 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.3ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:55:in `<main>'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 259ms (Views: 0.1ms | ActiveRecord: 31.6ms | Allocations: 14394)


Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:18:09 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (1.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:55:in `<main>'
  [1m[36mMessage Load (1.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 288ms (ActiveRecord: 31.6ms | Allocations: 15618)


  
Elasticsearch::Transport::Transport::Errors::BadRequest ([400] {"error":{"root_cause":[{"type":"parsing_exception","reason":"[term] query doesn't support multiple fields, found [chat_id] and [application_token]","line":1,"col":145}],"type":"x_content_parse_exception","reason":"[1:145] [bool] failed to parse field [filter]","caused_by":{"type":"parsing_exception","reason":"[term] query doesn't support multiple fields, found [chat_id] and [application_token]","line":1,"col":145}},"status":400}):
  
app/controllers/message_controller.rb:15:in `get'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (1.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (1.6ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (3, '2022-11-23 20:42:05', '2022-11-23 20:42:05', 1, 'EHmJBfWNXWRa6GNZJt4zv1Sw')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.6ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.5ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (4, '2022-11-23 20:42:05', '2022-11-23 20:42:05', 1, 'EHmJBfWNXWRa6GNZJt4zv1Sw')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.5ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:43:36 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:54:in `<main>'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 287ms (ActiveRecord: 15.9ms | Allocations: 25866)


  
Elasticsearch::Transport::Transport::Errors::BadRequest ([400] {"error":{"root_cause":[{"type":"parsing_exception","reason":"[term] query doesn't support multiple fields, found [chat_id] and [application_token]","line":1,"col":119}],"type":"x_content_parse_exception","reason":"[1:119] [bool] failed to parse field [filter]","caused_by":{"type":"parsing_exception","reason":"[term] query doesn't support multiple fields, found [chat_id] and [application_token]","line":1,"col":119}},"status":400}):
  
app/controllers/message_controller.rb:15:in `get'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (36.7ms)[0m  [1m[35mDROP INDEX `index_messages_on_application_token_and_chat_number` ON `messages`[0m
  [1m[35m (5.9ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[35m (5.3ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (10.2ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (5.9ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (5.7ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (5.2ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (6.5ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (24.1ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (11.9ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (10.6ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (5.5ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (40.8ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (6.7ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (11.0ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (11.6ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (3.0ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (5.4ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (9.0ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.0ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (9.3ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (5.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (13.3ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (16.6ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (27.4ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (16.2ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (9.4ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (3.5ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (8.0ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (11.2ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (8.4ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (9.2ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (5.6ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (22.3ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (18.4ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (7.1ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (8.9ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (6.5ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (7.7ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (6.6ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:45:36 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'PjCgKtWKzXDEUpMsoHN9uAC1' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
Filter chain halted as :set_chat rendered or redirected
Completed 404 Not Found in 15ms (Views: 0.2ms | ActiveRecord: 5.2ms | Allocations: 8013)


Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 22:45:41 +0200
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (1.9ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('KDEXG6Dva8zjBhinJ8qqhrWF', 'application 1', '2022-11-23 20:45:41.598044', '2022-11-23 20:45:41.598044')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 18ms (Views: 0.1ms | ActiveRecord: 8.9ms | Allocations: 7842)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 22:45:43 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 1288)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:45:51 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'KDEXG6Dva8zjBhinJ8qqhrWF' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 28ms (Views: 0.2ms | ActiveRecord: 2.8ms | Allocations: 9589)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.8ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (1, '2022-11-23 20:45:51.567272', '2022-11-23 20:45:51.567272', 1, 'KDEXG6Dva8zjBhinJ8qqhrWF')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.5ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:45:57 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'KDEXG6Dva8zjBhinJ8qqhrWF' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:54:in `<main>'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x000000011113abc0>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 291ms (Views: 0.2ms | ActiveRecord: 6.4ms | Allocations: 13559)


  [1m[36mMessage Load (0.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:54:in `<main>'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 1, '2022-11-23 20:45:58.388649', '2022-11-23 20:45:58.388649', 1, 'KDEXG6Dva8zjBhinJ8qqhrWF', 1)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.5ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:46:03 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (2.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'KDEXG6Dva8zjBhinJ8qqhrWF' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (2.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 33ms (ActiveRecord: 5.2ms | Allocations: 2765)


  
Elasticsearch::Transport::Transport::Errors::BadRequest ([400] {"error":{"root_cause":[{"type":"parsing_exception","reason":"[term] query doesn't support multiple fields, found [chat_id] and [application_token]","line":1,"col":119}],"type":"x_content_parse_exception","reason":"[1:119] [bool] failed to parse field [filter]","caused_by":{"type":"parsing_exception","reason":"[term] query doesn't support multiple fields, found [chat_id] and [application_token]","line":1,"col":119}},"status":400}):
  
app/controllers/message_controller.rb:15:in `get'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (22.0ms)[0m  [1m[35mDROP INDEX `index_messages_on_application_token_and_chat_number` ON `messages`[0m
  [1m[35m (4.0ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[35m (35.2ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (7.3ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (5.5ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (6.0ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (4.8ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (6.8ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (4.6ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.9ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (6.3ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (5.1ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (10.3ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (29.2ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (4.2ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (12.2ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.4ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (20.0ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.9ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (7.8ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.0ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (20.9ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (14.6ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (17.9ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (19.1ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (18.6ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (16.8ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (11.6ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (3.6ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (8.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (9.3ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (6.5ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (6.7ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (6.4ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (20.4ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (24.4ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (11.1ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (7.9ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (5.1ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (6.3ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 22:47:08 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (0.8ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('Auam2K6dk9unchV3b2hvcZhj', 'application 1', '2022-11-23 20:47:08.646441', '2022-11-23 20:47:08.646441')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 21ms (Views: 0.3ms | ActiveRecord: 8.1ms | Allocations: 11153)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 22:47:11 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 1325)


Started GET "/app/search/?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:47:25 +0200
Processing by AppController#get as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Auam2K6dk9unchV3b2hvcZhj' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 2306)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:47:33 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'Auam2K6dk9unchV3b2hvcZhj' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 23ms (Views: 0.2ms | ActiveRecord: 6.1ms | Allocations: 11304)


  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.8ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (1, '2022-11-23 20:47:33.226454', '2022-11-23 20:47:33.226454', 1, 'Auam2K6dk9unchV3b2hvcZhj')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.5ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:47:37 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'Auam2K6dk9unchV3b2hvcZhj' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:53:in `<main>'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x00000001132ab9d0>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 249ms (Views: 0.2ms | ActiveRecord: 8.5ms | Allocations: 14426)


  [1m[36mMessage Load (0.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:53:in `<main>'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.8ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 1, '2022-11-23 20:47:38.007196', '2022-11-23 20:47:38.007196', 1, 'Auam2K6dk9unchV3b2hvcZhj', 1)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.6ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:47:44 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'Auam2K6dk9unchV3b2hvcZhj' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 39ms (Views: 0.2ms | ActiveRecord: 2.3ms | Allocations: 2651)


Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:48:28 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'Auam2K6dk9unchV3b2hvcZhj' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:53:in `<main>'
  [1m[36mMessage Load (2.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 500 Internal Server Error in 283ms (ActiveRecord: 30.9ms | Allocations: 16056)


  
NoMethodError (undefined method `number' for #<Elasticsearch::Model::Response::Response:0x00000001137e7b60 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @search=#<Elasticsearch::Model::Searching::SearchRequest:0x00000001137e7d40 @klass=[PROXY] Message(id: integer, content: text, number: integer, created_at: datetime, updated_at: datetime, chat_id: integer, application_token: string, chat_number: integer), @options={}, @definition={:index=>"messages", :type=>nil, :body=>{:query=>{:bool=>{:must=>[{:match=>{:content=>"HELLO WORLD MSG"}}], :filter=>[{:term=>{:chat_id=>1}}]}}}}>>

      object.public_send(field_name)
            ^^^^^^^^^^^^):
  
app/controllers/message_controller.rb:15:in `get'
Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:48:43 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'Auam2K6dk9unchV3b2hvcZhj' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.3ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:53:in `<main>'
  [1m[36mMessage Load (1.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 182ms (Views: 0.2ms | ActiveRecord: 15.6ms | Allocations: 15376)


Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:48:56 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'Auam2K6dk9unchV3b2hvcZhj' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 1.4ms | Allocations: 2278)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (3.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (25.2ms)[0m  [1m[35mDROP INDEX `index_messages_on_application_token_and_chat_number` ON `messages`[0m
  [1m[35m (13.6ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[35m (5.2ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (6.5ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (17.1ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (18.7ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (5.1ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (8.9ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (5.5ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (5.7ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (4.7ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (5.0ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (12.9ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (4.5ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (35.0ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.9ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (5.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (14.8ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (1.2ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (18.8ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.9ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (7.0ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (2.7ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (2.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (22.9ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (14.1ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (12.0ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (13.9ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (10.7ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (8.8ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (3.8ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (15.6ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (8.6ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (6.0ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (6.5ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (6.5ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (5.7ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (36.7ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (7.5ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (11.0ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (5.8ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (6.2ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 22:56:21 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (0.9ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('KMzyb2423CzWBW5Go3iBG5J8', 'application 1', '2022-11-23 20:56:21.149580', '2022-11-23 20:56:21.149580')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 21ms (Views: 0.2ms | ActiveRecord: 8.9ms | Allocations: 11147)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 22:56:25 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 1325)


Started GET "/app/search/?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:56:35 +0200
Processing by AppController#get as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (1.1ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'KMzyb2423CzWBW5Go3iBG5J8' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
Completed 200 OK in 10ms (Views: 0.5ms | ActiveRecord: 1.1ms | Allocations: 2306)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:56:39 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'KMzyb2423CzWBW5Go3iBG5J8' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 50ms (Views: 0.2ms | ActiveRecord: 19.6ms | Allocations: 11304)


  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (0.6ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (1, '2022-11-23 20:56:40.117747', '2022-11-23 20:56:40.117747', 1, 'KMzyb2423CzWBW5Go3iBG5J8')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (0.5ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:56:49 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'KMzyb2423CzWBW5Go3iBG5J8' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (1.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:60:in `<main>'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x000000011115e958>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 293ms (Views: 0.2ms | ActiveRecord: 9.4ms | Allocations: 14436)


  [1m[36mMessage Load (1.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:60:in `<main>'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 1, '2022-11-23 20:56:50.009521', '2022-11-23 20:56:50.009521', 1, 'KMzyb2423CzWBW5Go3iBG5J8', 1)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.5ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:56:55 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'KMzyb2423CzWBW5Go3iBG5J8' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (2.3ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 34ms (Views: 0.2ms | ActiveRecord: 3.5ms | Allocations: 2415)


Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:57:08 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.2ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'KMzyb2423CzWBW5Go3iBG5J8' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 24ms (Views: 0.1ms | ActiveRecord: 1.7ms | Allocations: 2052)


Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:57:09 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'KMzyb2423CzWBW5Go3iBG5J8' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.3ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 1.2ms | Allocations: 2052)


Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:57:10 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'KMzyb2423CzWBW5Go3iBG5J8' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (3.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 38ms (Views: 0.3ms | ActiveRecord: 3.7ms | Allocations: 2050)


Started GET "/chat/messages?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 22:57:28 +0200
Processing by ChatController#get_messages as */*
  Parameters: {"chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'KMzyb2423CzWBW5Go3iBG5J8' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:38:in `set_chat'
  [1m[36mMessage Load (1.0ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  â†³ app/controllers/chat_controller.rb:25:in `get_messages'
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.6ms | Allocations: 2106)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (26.4ms)[0m  [1m[35mDROP INDEX `index_messages_on_application_token_and_chat_number` ON `messages`[0m
  [1m[35m (10.3ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_number`[0m
  [1m[35m (4.9ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.8ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122204849'[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (9.0ms)[0m  [1m[35mDROP INDEX `index_chats_on_application_token` ON `chats`[0m
  [1m[35m (8.7ms)[0m  [1m[35mDROP INDEX `index_chats_on_number_and_application_token` ON `chats`[0m
  [1m[35m (8.2ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `application_token`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122093859'[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (15.7ms)[0m  [1m[35mDROP INDEX `index_apps_on_token` ON `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122090014'[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (35.1ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `messages_count`[0m
  [1m[35m (18.1ms)[0m  [1m[35mALTER TABLE `apps` DROP COLUMN `chats_count`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221122084602'[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (5.8ms)[0m  [1m[35mDROP INDEX `index_messages_on_number` ON `messages`[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP INDEX `index_chats_on_number` ON `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221121120906'[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (5.0ms)[0m  [1m[35mALTER TABLE `messages` DROP FOREIGN KEY fk_rails_0f670de7ba[0m
  [1m[35m (14.4ms)[0m  [1m[35mALTER TABLE `messages` DROP COLUMN `chat_id`[0m
  [1m[35m (4.5ms)[0m  [1m[35mALTER TABLE `chats` DROP FOREIGN KEY fk_rails_de65013ee8[0m
  [1m[35m (16.2ms)[0m  [1m[35mALTER TABLE `chats` DROP COLUMN `app_id`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.4ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119142734'[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (6.5ms)[0m  [1m[35mDROP TABLE `apps`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.3ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133856'[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (1.9ms)[0m  [1m[35mDROP TABLE `chats`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (0.5ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133802'[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (2.5ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (2.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (19.3ms)[0m  [1m[35mDROP TABLE `messages`[0m
  [1m[36mActiveRecord::SchemaMigration Delete All (3.6ms)[0m  [1m[31mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20221119133739'[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at bin/rails:4)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT GET_LOCK('8728467095687636850', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateMessages (20221119133739)
  [1m[35m (29.0ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133739')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221119133802)
  [1m[35m (14.7ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133802')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateApps (20221119133856)
  [1m[35m (11.4ms)[0m  [1m[35mCREATE TABLE `apps` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `token` varchar(255), `name` varchar(255) NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_apps_on_name` (`name`))[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119133856')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddFkCols (20221119142734)
  [1m[35m (15.7ms)[0m  [1m[35mALTER TABLE `chats` ADD `app_id` bigint[0m
  [1m[35m (7.1ms)[0m  [1m[35mCREATE INDEX `index_chats_on_app_id` ON `chats` (`app_id`)[0m
  [1m[35m (8.5ms)[0m  [1m[35mALTER TABLE `chats` ADD CONSTRAINT `fk_rails_de65013ee8`
FOREIGN KEY (`app_id`)
  REFERENCES `apps` (`id`)
[0m
  [1m[35m (4.0ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_id` bigint[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE INDEX `index_messages_on_chat_id` ON `messages` (`chat_id`)[0m
  [1m[35m (8.6ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221119142734')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNumberingIndeces (20221121120906)
  [1m[35m (7.8ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number` ON `chats` (`number`)[0m
  [1m[35m (5.5ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_messages_on_number` ON `messages` (`number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221121120906')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCountsFields (20221122084602)
  [1m[35m (7.7ms)[0m  [1m[35mALTER TABLE `apps` ADD `chats_count` int DEFAULT 0[0m
  [1m[35m (5.9ms)[0m  [1m[35mALTER TABLE `chats` ADD `messages_count` int DEFAULT 0[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122084602')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToAppTable (20221122090014)
  [1m[35m (25.9ms)[0m  [1m[35mCREATE INDEX `index_apps_on_token` ON `apps` (`token`)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122090014')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToChatTable (20221122093859)
  [1m[35m (14.2ms)[0m  [1m[35mALTER TABLE `chats` ADD `application_token` varchar(255)[0m
  [1m[35m (7.7ms)[0m  [1m[35mCREATE UNIQUE INDEX `index_chats_on_number_and_application_token` ON `chats` (`number`, `application_token`)[0m
  [1m[35m (6.8ms)[0m  [1m[35mCREATE INDEX `index_chats_on_application_token` ON `chats` (`application_token`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122093859')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddIndexToMessageTable (20221122204849)
  [1m[35m (7.7ms)[0m  [1m[35mALTER TABLE `messages` ADD `application_token` varchar(255)[0m
  [1m[35m (3.7ms)[0m  [1m[35mALTER TABLE `messages` ADD `chat_number` int[0m
  [1m[35m (5.7ms)[0m  [1m[35mCREATE INDEX `index_messages_on_application_token_and_chat_number` ON `messages` (`application_token`, `chat_number`)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221122204849')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('8728467095687636850')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/create/app?name=application%201" for 127.0.0.1 at 2022-11-23 23:10:56 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <main> at /Users/marwahany/study/acm_sys/app/controllers/application_controller.rb:1)
Processing by AppController#post as */*
  Parameters: {"name"=>"application 1"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mApp Create (1.3ms)[0m  [1m[32mINSERT INTO `apps` (`token`, `name`, `created_at`, `updated_at`) VALUES ('qKnaS6AFNuW6zzZSgzzAKddp', 'application 1', '2022-11-23 21:10:56.974179', '2022-11-23 21:10:56.974179')[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:30:in `post'
Completed 201 Created in 22ms (Views: 0.3ms | ActiveRecord: 7.5ms | Allocations: 11153)


Started GET "/app/show/" for 127.0.0.1 at 2022-11-23 23:11:00 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (0.5ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 1325)


Started POST "/create/chat?application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 23:11:10 +0200
Processing by ChatController#post as */*
  Parameters: {"application_token"=>"[FILTERED]"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/chat_controller.rb:42:in `set_app'
Completed 201 Created in 25ms (Views: 0.2ms | ActiveRecord: 6.5ms | Allocations: 12560)


  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Load (1.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mChat Create (1.7ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `created_at`, `updated_at`, `app_id`, `application_token`) VALUES (1, '2022-11-23 21:11:10.308986', '2022-11-23 21:11:10.308986', 1, 'qKnaS6AFNuW6zzZSgzzAKddp')[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mApp Update All (2.6ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`chats_count` = COALESCE(`apps`.`chats_count`, 0) + 1 WHERE `apps`.`id` = 1[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/chat_worker.rb:7:in `block in perform'
Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 23:11:15 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:61:in `<main>'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x00000001130fd4d0>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 296ms (Views: 0.2ms | ActiveRecord: 11.1ms | Allocations: 14500)


  [1m[36mMessage Load (1.0ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:61:in `<main>'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (0.4ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 1, '2022-11-23 21:11:16.099274', '2022-11-23 21:11:16.099274', 1, 'qKnaS6AFNuW6zzZSgzzAKddp', 1)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.3ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/message/show?chat_number=1&body=HELLO%20WORLD%20MSG&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 23:11:22 +0200
Processing by MessageController#get as */*
  Parameters: {"chat_number"=>"1", "body"=>"HELLO WORLD MSG", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
  [1m[36mMessage Load (2.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:50:in `set_message'
Completed 200 OK in 42ms (Views: 0.2ms | ActiveRecord: 2.7ms | Allocations: 2606)


Started GET "/app/chats?token=[FILTERED]" for 127.0.0.1 at 2022-11-23 23:12:49 +0200
Processing by AppController#get_chats as */*
  Parameters: {"token"=>"[FILTERED]"}
  [1m[36mApp Load (1.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:38:in `set_app'
  [1m[36mChat Load (2.3ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`app_id` = 1[0m
  â†³ app/controllers/app_controller.rb:21:in `get_chats'
Completed 200 OK in 13ms (Views: 0.6ms | ActiveRecord: 3.9ms | Allocations: 2186)


Started POST "/create/message?chat_number=1&application_token=[FILTERED]" for 127.0.0.1 at 2022-11-23 23:13:39 +0200
Processing by MessageController#post as JSON
  Parameters: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`number` = 1 AND `chats`.`application_token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:45:in `set_chat'
[31mUnpermitted parameters: :chat_number, :application_token. Context: { controller: MessageController, action: post, request: #<ActionDispatch::Request:0x00000001133018d0>, params: {"content"=>"HELLO WORLD MSG", "chat_number"=>"1", "application_token"=>"[FILTERED]", "controller"=>"message", "action"=>"post"} }[0m
Completed 201 Created in 6ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1218)


  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mMessage Create (2.7ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `number`, `created_at`, `updated_at`, `chat_id`, `application_token`, `chat_number`) VALUES ('HELLO WORLD MSG', 2, '2022-11-23 21:13:39.125110', '2022-11-23 21:13:39.125110', 1, 'qKnaS6AFNuW6zzZSgzzAKddp', 1)[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mChat Update All (0.6ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`messages_count` = COALESCE(`chats`.`messages_count`, 0) + 1 WHERE `chats`.`id` = 1[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/workers/message_worker.rb:7:in `block in perform'
Started GET "/app/show/" for 127.0.0.1 at 2022-11-24 00:12:14 +0200
Processing by AppController#index as */*
  [1m[36mApp Load (2.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 16ms (Views: 0.3ms | ActiveRecord: 4.2ms | Allocations: 3862)


Started PUT "/update/message/content/?chat_number=1&application_token=[FILTERED]&message_number=1" for 127.0.0.1 at 2022-11-24 00:19:42 +0200
Processing by MessageController#update as JSON
  Parameters: {"content"=>"NEW CONTENT", "chat_number"=>"1", "application_token"=>"[FILTERED]", "message_number"=>"1"}
  [1m[36mMessage Load (1.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` ORDER BY `messages`.`id` ASC LIMIT 1000[0m
  â†³ app/models/message.rb:61:in `<main>'
  [1m[36mMessage Load (5.5ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` IS NULL AND `messages`.`chat_number` = 1 AND `messages`.`application_token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:64:in `set_message'
Completed 404 Not Found in 266ms (Views: 0.2ms | ActiveRecord: 7.8ms | Allocations: 10999)


Started PUT "/update/message/content/?chat_number=1&application_token=[FILTERED]&number=1" for 127.0.0.1 at 2022-11-24 00:20:05 +0200
Processing by MessageController#update as JSON
  Parameters: {"content"=>"NEW CONTENT", "chat_number"=>"1", "application_token"=>"[FILTERED]", "number"=>"1"}
  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`number` = 1 AND `messages`.`chat_number` = 1 AND `messages`.`application_token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:64:in `set_message'
[31mUnpermitted parameters: :chat_number, :application_token, :number. Context: { controller: MessageController, action: update, request: #<ActionDispatch::Request:0x0000000112844078>, params: {"content"=>"NEW CONTENT", "chat_number"=>"1", "application_token"=>"[FILTERED]", "number"=>"1", "controller"=>"message", "action"=>"update"} }[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/message_controller.rb:23:in `update'
  [1m[36mChat Load (1.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`id` = 1 LIMIT 1[0m
  â†³ app/controllers/message_controller.rb:23:in `update'
  [1m[36mMessage Update (1.7ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`content` = 'NEW CONTENT', `messages`.`updated_at` = '2022-11-23 22:20:05.055265' WHERE `messages`.`id` = 1[0m
  â†³ app/controllers/message_controller.rb:23:in `update'
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/message_controller.rb:23:in `update'
Completed 202 Accepted in 52ms (Views: 0.4ms | ActiveRecord: 6.2ms | Allocations: 9169)


Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:27:26 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (1.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:49:in `set_app'
Completed 500 Internal Server Error in 14ms (ActiveRecord: 2.5ms | Allocations: 4232)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/app_controller.rb:28:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:28:55 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (1.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:50:in `set_app'
Completed 500 Internal Server Error in 23ms (ActiveRecord: 13.1ms | Allocations: 4455)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/app_controller.rb:28:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:29:42 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (10.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:50:in `set_app'
Completed 500 Internal Server Error in 30ms (ActiveRecord: 20.7ms | Allocations: 4380)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/app_controller.rb:28:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:32:02 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
Completed 500 Internal Server Error in 32ms (ActiveRecord: 19.8ms | Allocations: 7496)


  
NameError (undefined local variable or method `app' for #<AppController:0x00000000025ee0>

        if app.present?
           ^^^
Did you mean?  @app):
  
app/controllers/app_controller.rb:28:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:32:35 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (1.0ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
Completed 500 Internal Server Error in 41ms (ActiveRecord: 30.7ms | Allocations: 7435)


  
NameError (undefined local variable or method `app' for #<AppController:0x0000000002a3a0>

        if app.present?
           ^^^
Did you mean?  @app):
  
app/controllers/app_controller.rb:28:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:32:46 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
Completed 500 Internal Server Error in 14ms (ActiveRecord: 8.1ms | Allocations: 4431)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/app_controller.rb:29:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:33:44 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (0.8ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
Completed 500 Internal Server Error in 17ms (ActiveRecord: 11.0ms | Allocations: 4380)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/app_controller.rb:29:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:34:52 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (0.7ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
Completed 500 Internal Server Error in 18ms (ActiveRecord: 10.5ms | Allocations: 5927)


  
NoMethodError (undefined method `permit' for "NEW APP NAME":String

        params.require(:name).permit(:name)
                             ^^^^^^^):
  
app/controllers/app_controller.rb:38:in `app_params'
app/controllers/app_controller.rb:29:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:35:02 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (0.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
Completed 500 Internal Server Error in 27ms (ActiveRecord: 9.6ms | Allocations: 4432)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/app_controller.rb:29:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:35:54 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (0.6ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
Completed 500 Internal Server Error in 25ms (ActiveRecord: 16.1ms | Allocations: 4381)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/app_controller.rb:29:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:36:21 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (1.2ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
Completed 500 Internal Server Error in 15ms (ActiveRecord: 10.0ms | Allocations: 4433)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/app_controller.rb:29:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:36:37 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
Completed 500 Internal Server Error in 11ms (ActiveRecord: 5.6ms | Allocations: 4385)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/app_controller.rb:29:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:37:05 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (0.3ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
Completed 500 Internal Server Error in 12ms (ActiveRecord: 6.8ms | Allocations: 4433)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/app_controller.rb:29:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:37:31 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (1.0ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
Completed 500 Internal Server Error in 15ms (ActiveRecord: 9.7ms | Allocations: 4338)


  
ArgumentError (When assigning attributes, you must pass a hash as an argument, String passed.):
  
app/controllers/app_controller.rb:29:in `update'
Started PUT "/update/app/name/?token=[FILTERED]" for 127.0.0.1 at 2022-11-24 00:39:08 +0200
Processing by AppController#update as JSON
  Parameters: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]"}
  [1m[36mApp Load (0.9ms)[0m  [1m[34mSELECT `apps`.* FROM `apps` WHERE `apps`.`token` = 'qKnaS6AFNuW6zzZSgzzAKddp' LIMIT 1[0m
  â†³ app/controllers/app_controller.rb:52:in `set_app'
[31mUnpermitted parameter: :token. Context: { controller: AppController, action: update, request: #<ActionDispatch::Request:0x00000001139326f0>, params: {"name"=>"NEW APP NAME", "token"=>"[FILTERED]", "controller"=>"app", "action"=>"update"} }[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/app_controller.rb:29:in `update'
  [1m[36mApp Update (7.8ms)[0m  [1m[33mUPDATE `apps` SET `apps`.`name` = 'NEW APP NAME', `apps`.`updated_at` = '2022-11-23 22:39:09.092102' WHERE `apps`.`id` = 1[0m
  â†³ app/controllers/app_controller.rb:29:in `update'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/app_controller.rb:29:in `update'
Completed 200 OK in 37ms (Views: 0.3ms | ActiveRecord: 23.8ms | Allocations: 6508)


DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/actionpack-7.0.4/lib/action_controller/railtie.rb:80)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /Users/marwahany/.rbenv/versions/3.1.2/lib/ruby/gems/3.1.0/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started GET "/app/show/" for 127.0.0.1 at 2022-11-24 01:09:37 +0200
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by AppController#index as */*
  [1m[36mApp Load (6.4ms)[0m  [1m[34mSELECT `apps`.* FROM `apps`[0m
  â†³ app/controllers/app_controller.rb:7:in `index'
Completed 200 OK in 29ms (Views: 0.3ms | ActiveRecord: 14.3ms | Allocations: 9073)


